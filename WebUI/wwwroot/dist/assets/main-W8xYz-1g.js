var Rr=Object.defineProperty;var Mr=(r,e,t)=>e in r?Rr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e,t)=>(Mr(r,typeof e!="symbol"?e+"":e,t),t),Mt=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var g=(r,e,t)=>(Mt(r,e,"read from private field"),t?t.call(r):e.get(r)),p=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},C=(r,e,t,s)=>(Mt(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t);var f=(r,e,t)=>(Mt(r,e,"access private method"),t);class Ir{constructor(e,t,s){this.eventTarget=e,this.eventName=t,this.eventOptions=s,this.unorderedBindings=new Set}connect(){this.eventTarget.addEventListener(this.eventName,this,this.eventOptions)}disconnect(){this.eventTarget.removeEventListener(this.eventName,this,this.eventOptions)}bindingConnected(e){this.unorderedBindings.add(e)}bindingDisconnected(e){this.unorderedBindings.delete(e)}handleEvent(e){const t=Pr(e);for(const s of this.bindings){if(t.immediatePropagationStopped)break;s.handleEvent(t)}}hasBindings(){return this.unorderedBindings.size>0}get bindings(){return Array.from(this.unorderedBindings).sort((e,t)=>{const s=e.index,n=t.index;return s<n?-1:s>n?1:0})}}function Pr(r){if("immediatePropagationStopped"in r)return r;{const{stopImmediatePropagation:e}=r;return Object.assign(r,{immediatePropagationStopped:!1,stopImmediatePropagation(){this.immediatePropagationStopped=!0,e.call(this)}})}}class Lr{constructor(e){this.application=e,this.eventListenerMaps=new Map,this.started=!1}start(){this.started||(this.started=!0,this.eventListeners.forEach(e=>e.connect()))}stop(){this.started&&(this.started=!1,this.eventListeners.forEach(e=>e.disconnect()))}get eventListeners(){return Array.from(this.eventListenerMaps.values()).reduce((e,t)=>e.concat(Array.from(t.values())),[])}bindingConnected(e){this.fetchEventListenerForBinding(e).bindingConnected(e)}bindingDisconnected(e,t=!1){this.fetchEventListenerForBinding(e).bindingDisconnected(e),t&&this.clearEventListenersForBinding(e)}handleError(e,t,s={}){this.application.handleError(e,`Error ${t}`,s)}clearEventListenersForBinding(e){const t=this.fetchEventListenerForBinding(e);t.hasBindings()||(t.disconnect(),this.removeMappedEventListenerFor(e))}removeMappedEventListenerFor(e){const{eventTarget:t,eventName:s,eventOptions:n}=e,i=this.fetchEventListenerMapForEventTarget(t),o=this.cacheKey(s,n);i.delete(o),i.size==0&&this.eventListenerMaps.delete(t)}fetchEventListenerForBinding(e){const{eventTarget:t,eventName:s,eventOptions:n}=e;return this.fetchEventListener(t,s,n)}fetchEventListener(e,t,s){const n=this.fetchEventListenerMapForEventTarget(e),i=this.cacheKey(t,s);let o=n.get(i);return o||(o=this.createEventListener(e,t,s),n.set(i,o)),o}createEventListener(e,t,s){const n=new Ir(e,t,s);return this.started&&n.connect(),n}fetchEventListenerMapForEventTarget(e){let t=this.eventListenerMaps.get(e);return t||(t=new Map,this.eventListenerMaps.set(e,t)),t}cacheKey(e,t){const s=[e];return Object.keys(t).sort().forEach(n=>{s.push(`${t[n]?"":"!"}${n}`)}),s.join(":")}}const Or={stop({event:r,value:e}){return e&&r.stopPropagation(),!0},prevent({event:r,value:e}){return e&&r.preventDefault(),!0},self({event:r,value:e,element:t}){return e?t===r.target:!0}},Fr=/^(?:(?:([^.]+?)\+)?(.+?)(?:\.(.+?))?(?:@(window|document))?->)?(.+?)(?:#([^:]+?))(?::(.+))?$/;function Dr(r){const t=r.trim().match(Fr)||[];let s=t[2],n=t[3];return n&&!["keydown","keyup","keypress"].includes(s)&&(s+=`.${n}`,n=""),{eventTarget:Br(t[4]),eventName:s,eventOptions:t[7]?Nr(t[7]):{},identifier:t[5],methodName:t[6],keyFilter:t[1]||n}}function Br(r){if(r=="window")return window;if(r=="document")return document}function Nr(r){return r.split(":").reduce((e,t)=>Object.assign(e,{[t.replace(/^!/,"")]:!/^!/.test(t)}),{})}function $r(r){if(r==window)return"window";if(r==document)return"document"}function Wt(r){return r.replace(/(?:[_-])([a-z0-9])/g,(e,t)=>t.toUpperCase())}function It(r){return Wt(r.replace(/--/g,"-").replace(/__/g,"_"))}function Oe(r){return r.charAt(0).toUpperCase()+r.slice(1)}function Ms(r){return r.replace(/([A-Z])/g,(e,t)=>`-${t.toLowerCase()}`)}function Hr(r){return r.match(/[^\s]+/g)||[]}function os(r){return r!=null}function Pt(r,e){return Object.prototype.hasOwnProperty.call(r,e)}const as=["meta","ctrl","alt","shift"];class xr{constructor(e,t,s,n){this.element=e,this.index=t,this.eventTarget=s.eventTarget||e,this.eventName=s.eventName||qr(e)||Be("missing event name"),this.eventOptions=s.eventOptions||{},this.identifier=s.identifier||Be("missing identifier"),this.methodName=s.methodName||Be("missing method name"),this.keyFilter=s.keyFilter||"",this.schema=n}static forToken(e,t){return new this(e.element,e.index,Dr(e.content),t)}toString(){const e=this.keyFilter?`.${this.keyFilter}`:"",t=this.eventTargetName?`@${this.eventTargetName}`:"";return`${this.eventName}${e}${t}->${this.identifier}#${this.methodName}`}shouldIgnoreKeyboardEvent(e){if(!this.keyFilter)return!1;const t=this.keyFilter.split("+");if(this.keyFilterDissatisfied(e,t))return!0;const s=t.filter(n=>!as.includes(n))[0];return s?(Pt(this.keyMappings,s)||Be(`contains unknown key filter: ${this.keyFilter}`),this.keyMappings[s].toLowerCase()!==e.key.toLowerCase()):!1}shouldIgnoreMouseEvent(e){if(!this.keyFilter)return!1;const t=[this.keyFilter];return!!this.keyFilterDissatisfied(e,t)}get params(){const e={},t=new RegExp(`^data-${this.identifier}-(.+)-param$`,"i");for(const{name:s,value:n}of Array.from(this.element.attributes)){const i=s.match(t),o=i&&i[1];o&&(e[Wt(o)]=Vr(n))}return e}get eventTargetName(){return $r(this.eventTarget)}get keyMappings(){return this.schema.keyMappings}keyFilterDissatisfied(e,t){const[s,n,i,o]=as.map(a=>t.includes(a));return e.metaKey!==s||e.ctrlKey!==n||e.altKey!==i||e.shiftKey!==o}}const cs={a:()=>"click",button:()=>"click",form:()=>"submit",details:()=>"toggle",input:r=>r.getAttribute("type")=="submit"?"click":"input",select:()=>"change",textarea:()=>"input"};function qr(r){const e=r.tagName.toLowerCase();if(e in cs)return cs[e](r)}function Be(r){throw new Error(r)}function Vr(r){try{return JSON.parse(r)}catch{return r}}class Wr{constructor(e,t){this.context=e,this.action=t}get index(){return this.action.index}get eventTarget(){return this.action.eventTarget}get eventOptions(){return this.action.eventOptions}get identifier(){return this.context.identifier}handleEvent(e){const t=this.prepareActionEvent(e);this.willBeInvokedByEvent(e)&&this.applyEventModifiers(t)&&this.invokeWithEvent(t)}get eventName(){return this.action.eventName}get method(){const e=this.controller[this.methodName];if(typeof e=="function")return e;throw new Error(`Action "${this.action}" references undefined method "${this.methodName}"`)}applyEventModifiers(e){const{element:t}=this.action,{actionDescriptorFilters:s}=this.context.application,{controller:n}=this.context;let i=!0;for(const[o,a]of Object.entries(this.eventOptions))if(o in s){const l=s[o];i=i&&l({name:o,value:a,event:e,element:t,controller:n})}else continue;return i}prepareActionEvent(e){return Object.assign(e,{params:this.action.params})}invokeWithEvent(e){const{target:t,currentTarget:s}=e;try{this.method.call(this.controller,e),this.context.logDebugActivity(this.methodName,{event:e,target:t,currentTarget:s,action:this.methodName})}catch(n){const{identifier:i,controller:o,element:a,index:l}=this,u={identifier:i,controller:o,element:a,index:l,event:e};this.context.handleError(n,`invoking action "${this.action}"`,u)}}willBeInvokedByEvent(e){const t=e.target;return e instanceof KeyboardEvent&&this.action.shouldIgnoreKeyboardEvent(e)||e instanceof MouseEvent&&this.action.shouldIgnoreMouseEvent(e)?!1:this.element===t?!0:t instanceof Element&&this.element.contains(t)?this.scope.containsElement(t):this.scope.containsElement(this.action.element)}get controller(){return this.context.controller}get methodName(){return this.action.methodName}get element(){return this.scope.element}get scope(){return this.context.scope}}class Is{constructor(e,t){this.mutationObserverInit={attributes:!0,childList:!0,subtree:!0},this.element=e,this.started=!1,this.delegate=t,this.elements=new Set,this.mutationObserver=new MutationObserver(s=>this.processMutations(s))}start(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,this.mutationObserverInit),this.refresh())}pause(e){this.started&&(this.mutationObserver.disconnect(),this.started=!1),e(),this.started||(this.mutationObserver.observe(this.element,this.mutationObserverInit),this.started=!0)}stop(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}refresh(){if(this.started){const e=new Set(this.matchElementsInTree());for(const t of Array.from(this.elements))e.has(t)||this.removeElement(t);for(const t of Array.from(e))this.addElement(t)}}processMutations(e){if(this.started)for(const t of e)this.processMutation(t)}processMutation(e){e.type=="attributes"?this.processAttributeChange(e.target,e.attributeName):e.type=="childList"&&(this.processRemovedNodes(e.removedNodes),this.processAddedNodes(e.addedNodes))}processAttributeChange(e,t){this.elements.has(e)?this.delegate.elementAttributeChanged&&this.matchElement(e)?this.delegate.elementAttributeChanged(e,t):this.removeElement(e):this.matchElement(e)&&this.addElement(e)}processRemovedNodes(e){for(const t of Array.from(e)){const s=this.elementFromNode(t);s&&this.processTree(s,this.removeElement)}}processAddedNodes(e){for(const t of Array.from(e)){const s=this.elementFromNode(t);s&&this.elementIsActive(s)&&this.processTree(s,this.addElement)}}matchElement(e){return this.delegate.matchElement(e)}matchElementsInTree(e=this.element){return this.delegate.matchElementsInTree(e)}processTree(e,t){for(const s of this.matchElementsInTree(e))t.call(this,s)}elementFromNode(e){if(e.nodeType==Node.ELEMENT_NODE)return e}elementIsActive(e){return e.isConnected!=this.element.isConnected?!1:this.element.contains(e)}addElement(e){this.elements.has(e)||this.elementIsActive(e)&&(this.elements.add(e),this.delegate.elementMatched&&this.delegate.elementMatched(e))}removeElement(e){this.elements.has(e)&&(this.elements.delete(e),this.delegate.elementUnmatched&&this.delegate.elementUnmatched(e))}}class Ps{constructor(e,t,s){this.attributeName=t,this.delegate=s,this.elementObserver=new Is(e,this)}get element(){return this.elementObserver.element}get selector(){return`[${this.attributeName}]`}start(){this.elementObserver.start()}pause(e){this.elementObserver.pause(e)}stop(){this.elementObserver.stop()}refresh(){this.elementObserver.refresh()}get started(){return this.elementObserver.started}matchElement(e){return e.hasAttribute(this.attributeName)}matchElementsInTree(e){const t=this.matchElement(e)?[e]:[],s=Array.from(e.querySelectorAll(this.selector));return t.concat(s)}elementMatched(e){this.delegate.elementMatchedAttribute&&this.delegate.elementMatchedAttribute(e,this.attributeName)}elementUnmatched(e){this.delegate.elementUnmatchedAttribute&&this.delegate.elementUnmatchedAttribute(e,this.attributeName)}elementAttributeChanged(e,t){this.delegate.elementAttributeValueChanged&&this.attributeName==t&&this.delegate.elementAttributeValueChanged(e,t)}}function jr(r,e,t){Ls(r,e).add(t)}function Ur(r,e,t){Ls(r,e).delete(t),Kr(r,e)}function Ls(r,e){let t=r.get(e);return t||(t=new Set,r.set(e,t)),t}function Kr(r,e){const t=r.get(e);t!=null&&t.size==0&&r.delete(e)}class G{constructor(){this.valuesByKey=new Map}get keys(){return Array.from(this.valuesByKey.keys())}get values(){return Array.from(this.valuesByKey.values()).reduce((t,s)=>t.concat(Array.from(s)),[])}get size(){return Array.from(this.valuesByKey.values()).reduce((t,s)=>t+s.size,0)}add(e,t){jr(this.valuesByKey,e,t)}delete(e,t){Ur(this.valuesByKey,e,t)}has(e,t){const s=this.valuesByKey.get(e);return s!=null&&s.has(t)}hasKey(e){return this.valuesByKey.has(e)}hasValue(e){return Array.from(this.valuesByKey.values()).some(s=>s.has(e))}getValuesForKey(e){const t=this.valuesByKey.get(e);return t?Array.from(t):[]}getKeysForValue(e){return Array.from(this.valuesByKey).filter(([t,s])=>s.has(e)).map(([t,s])=>t)}}class zr{constructor(e,t,s,n){this._selector=t,this.details=n,this.elementObserver=new Is(e,this),this.delegate=s,this.matchesByElement=new G}get started(){return this.elementObserver.started}get selector(){return this._selector}set selector(e){this._selector=e,this.refresh()}start(){this.elementObserver.start()}pause(e){this.elementObserver.pause(e)}stop(){this.elementObserver.stop()}refresh(){this.elementObserver.refresh()}get element(){return this.elementObserver.element}matchElement(e){const{selector:t}=this;if(t){const s=e.matches(t);return this.delegate.selectorMatchElement?s&&this.delegate.selectorMatchElement(e,this.details):s}else return!1}matchElementsInTree(e){const{selector:t}=this;if(t){const s=this.matchElement(e)?[e]:[],n=Array.from(e.querySelectorAll(t)).filter(i=>this.matchElement(i));return s.concat(n)}else return[]}elementMatched(e){const{selector:t}=this;t&&this.selectorMatched(e,t)}elementUnmatched(e){const t=this.matchesByElement.getKeysForValue(e);for(const s of t)this.selectorUnmatched(e,s)}elementAttributeChanged(e,t){const{selector:s}=this;if(s){const n=this.matchElement(e),i=this.matchesByElement.has(s,e);n&&!i?this.selectorMatched(e,s):!n&&i&&this.selectorUnmatched(e,s)}}selectorMatched(e,t){this.delegate.selectorMatched(e,t,this.details),this.matchesByElement.add(t,e)}selectorUnmatched(e,t){this.delegate.selectorUnmatched(e,t,this.details),this.matchesByElement.delete(t,e)}}class Jr{constructor(e,t){this.element=e,this.delegate=t,this.started=!1,this.stringMap=new Map,this.mutationObserver=new MutationObserver(s=>this.processMutations(s))}start(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,{attributes:!0,attributeOldValue:!0}),this.refresh())}stop(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}refresh(){if(this.started)for(const e of this.knownAttributeNames)this.refreshAttribute(e,null)}processMutations(e){if(this.started)for(const t of e)this.processMutation(t)}processMutation(e){const t=e.attributeName;t&&this.refreshAttribute(t,e.oldValue)}refreshAttribute(e,t){const s=this.delegate.getStringMapKeyForAttribute(e);if(s!=null){this.stringMap.has(e)||this.stringMapKeyAdded(s,e);const n=this.element.getAttribute(e);if(this.stringMap.get(e)!=n&&this.stringMapValueChanged(n,s,t),n==null){const i=this.stringMap.get(e);this.stringMap.delete(e),i&&this.stringMapKeyRemoved(s,e,i)}else this.stringMap.set(e,n)}}stringMapKeyAdded(e,t){this.delegate.stringMapKeyAdded&&this.delegate.stringMapKeyAdded(e,t)}stringMapValueChanged(e,t,s){this.delegate.stringMapValueChanged&&this.delegate.stringMapValueChanged(e,t,s)}stringMapKeyRemoved(e,t,s){this.delegate.stringMapKeyRemoved&&this.delegate.stringMapKeyRemoved(e,t,s)}get knownAttributeNames(){return Array.from(new Set(this.currentAttributeNames.concat(this.recordedAttributeNames)))}get currentAttributeNames(){return Array.from(this.element.attributes).map(e=>e.name)}get recordedAttributeNames(){return Array.from(this.stringMap.keys())}}class Os{constructor(e,t,s){this.attributeObserver=new Ps(e,t,this),this.delegate=s,this.tokensByElement=new G}get started(){return this.attributeObserver.started}start(){this.attributeObserver.start()}pause(e){this.attributeObserver.pause(e)}stop(){this.attributeObserver.stop()}refresh(){this.attributeObserver.refresh()}get element(){return this.attributeObserver.element}get attributeName(){return this.attributeObserver.attributeName}elementMatchedAttribute(e){this.tokensMatched(this.readTokensForElement(e))}elementAttributeValueChanged(e){const[t,s]=this.refreshTokensForElement(e);this.tokensUnmatched(t),this.tokensMatched(s)}elementUnmatchedAttribute(e){this.tokensUnmatched(this.tokensByElement.getValuesForKey(e))}tokensMatched(e){e.forEach(t=>this.tokenMatched(t))}tokensUnmatched(e){e.forEach(t=>this.tokenUnmatched(t))}tokenMatched(e){this.delegate.tokenMatched(e),this.tokensByElement.add(e.element,e)}tokenUnmatched(e){this.delegate.tokenUnmatched(e),this.tokensByElement.delete(e.element,e)}refreshTokensForElement(e){const t=this.tokensByElement.getValuesForKey(e),s=this.readTokensForElement(e),n=Gr(t,s).findIndex(([i,o])=>!Yr(i,o));return n==-1?[[],[]]:[t.slice(n),s.slice(n)]}readTokensForElement(e){const t=this.attributeName,s=e.getAttribute(t)||"";return Xr(s,e,t)}}function Xr(r,e,t){return r.trim().split(/\s+/).filter(s=>s.length).map((s,n)=>({element:e,attributeName:t,content:s,index:n}))}function Gr(r,e){const t=Math.max(r.length,e.length);return Array.from({length:t},(s,n)=>[r[n],e[n]])}function Yr(r,e){return r&&e&&r.index==e.index&&r.content==e.content}class Fs{constructor(e,t,s){this.tokenListObserver=new Os(e,t,this),this.delegate=s,this.parseResultsByToken=new WeakMap,this.valuesByTokenByElement=new WeakMap}get started(){return this.tokenListObserver.started}start(){this.tokenListObserver.start()}stop(){this.tokenListObserver.stop()}refresh(){this.tokenListObserver.refresh()}get element(){return this.tokenListObserver.element}get attributeName(){return this.tokenListObserver.attributeName}tokenMatched(e){const{element:t}=e,{value:s}=this.fetchParseResultForToken(e);s&&(this.fetchValuesByTokenForElement(t).set(e,s),this.delegate.elementMatchedValue(t,s))}tokenUnmatched(e){const{element:t}=e,{value:s}=this.fetchParseResultForToken(e);s&&(this.fetchValuesByTokenForElement(t).delete(e),this.delegate.elementUnmatchedValue(t,s))}fetchParseResultForToken(e){let t=this.parseResultsByToken.get(e);return t||(t=this.parseToken(e),this.parseResultsByToken.set(e,t)),t}fetchValuesByTokenForElement(e){let t=this.valuesByTokenByElement.get(e);return t||(t=new Map,this.valuesByTokenByElement.set(e,t)),t}parseToken(e){try{return{value:this.delegate.parseValueForToken(e)}}catch(t){return{error:t}}}}class Qr{constructor(e,t){this.context=e,this.delegate=t,this.bindingsByAction=new Map}start(){this.valueListObserver||(this.valueListObserver=new Fs(this.element,this.actionAttribute,this),this.valueListObserver.start())}stop(){this.valueListObserver&&(this.valueListObserver.stop(),delete this.valueListObserver,this.disconnectAllActions())}get element(){return this.context.element}get identifier(){return this.context.identifier}get actionAttribute(){return this.schema.actionAttribute}get schema(){return this.context.schema}get bindings(){return Array.from(this.bindingsByAction.values())}connectAction(e){const t=new Wr(this.context,e);this.bindingsByAction.set(e,t),this.delegate.bindingConnected(t)}disconnectAction(e){const t=this.bindingsByAction.get(e);t&&(this.bindingsByAction.delete(e),this.delegate.bindingDisconnected(t))}disconnectAllActions(){this.bindings.forEach(e=>this.delegate.bindingDisconnected(e,!0)),this.bindingsByAction.clear()}parseValueForToken(e){const t=xr.forToken(e,this.schema);if(t.identifier==this.identifier)return t}elementMatchedValue(e,t){this.connectAction(t)}elementUnmatchedValue(e,t){this.disconnectAction(t)}}class Zr{constructor(e,t){this.context=e,this.receiver=t,this.stringMapObserver=new Jr(this.element,this),this.valueDescriptorMap=this.controller.valueDescriptorMap}start(){this.stringMapObserver.start(),this.invokeChangedCallbacksForDefaultValues()}stop(){this.stringMapObserver.stop()}get element(){return this.context.element}get controller(){return this.context.controller}getStringMapKeyForAttribute(e){if(e in this.valueDescriptorMap)return this.valueDescriptorMap[e].name}stringMapKeyAdded(e,t){const s=this.valueDescriptorMap[t];this.hasValue(e)||this.invokeChangedCallback(e,s.writer(this.receiver[e]),s.writer(s.defaultValue))}stringMapValueChanged(e,t,s){const n=this.valueDescriptorNameMap[t];e!==null&&(s===null&&(s=n.writer(n.defaultValue)),this.invokeChangedCallback(t,e,s))}stringMapKeyRemoved(e,t,s){const n=this.valueDescriptorNameMap[e];this.hasValue(e)?this.invokeChangedCallback(e,n.writer(this.receiver[e]),s):this.invokeChangedCallback(e,n.writer(n.defaultValue),s)}invokeChangedCallbacksForDefaultValues(){for(const{key:e,name:t,defaultValue:s,writer:n}of this.valueDescriptors)s!=null&&!this.controller.data.has(e)&&this.invokeChangedCallback(t,n(s),void 0)}invokeChangedCallback(e,t,s){const n=`${e}Changed`,i=this.receiver[n];if(typeof i=="function"){const o=this.valueDescriptorNameMap[e];try{const a=o.reader(t);let l=s;s&&(l=o.reader(s)),i.call(this.receiver,a,l)}catch(a){throw a instanceof TypeError&&(a.message=`Stimulus Value "${this.context.identifier}.${o.name}" - ${a.message}`),a}}}get valueDescriptors(){const{valueDescriptorMap:e}=this;return Object.keys(e).map(t=>e[t])}get valueDescriptorNameMap(){const e={};return Object.keys(this.valueDescriptorMap).forEach(t=>{const s=this.valueDescriptorMap[t];e[s.name]=s}),e}hasValue(e){const t=this.valueDescriptorNameMap[e],s=`has${Oe(t.name)}`;return this.receiver[s]}}class en{constructor(e,t){this.context=e,this.delegate=t,this.targetsByName=new G}start(){this.tokenListObserver||(this.tokenListObserver=new Os(this.element,this.attributeName,this),this.tokenListObserver.start())}stop(){this.tokenListObserver&&(this.disconnectAllTargets(),this.tokenListObserver.stop(),delete this.tokenListObserver)}tokenMatched({element:e,content:t}){this.scope.containsElement(e)&&this.connectTarget(e,t)}tokenUnmatched({element:e,content:t}){this.disconnectTarget(e,t)}connectTarget(e,t){var s;this.targetsByName.has(t,e)||(this.targetsByName.add(t,e),(s=this.tokenListObserver)===null||s===void 0||s.pause(()=>this.delegate.targetConnected(e,t)))}disconnectTarget(e,t){var s;this.targetsByName.has(t,e)&&(this.targetsByName.delete(t,e),(s=this.tokenListObserver)===null||s===void 0||s.pause(()=>this.delegate.targetDisconnected(e,t)))}disconnectAllTargets(){for(const e of this.targetsByName.keys)for(const t of this.targetsByName.getValuesForKey(e))this.disconnectTarget(t,e)}get attributeName(){return`data-${this.context.identifier}-target`}get element(){return this.context.element}get scope(){return this.context.scope}}function Fe(r,e){const t=Ds(r);return Array.from(t.reduce((s,n)=>(sn(n,e).forEach(i=>s.add(i)),s),new Set))}function tn(r,e){return Ds(r).reduce((s,n)=>(s.push(...rn(n,e)),s),[])}function Ds(r){const e=[];for(;r;)e.push(r),r=Object.getPrototypeOf(r);return e.reverse()}function sn(r,e){const t=r[e];return Array.isArray(t)?t:[]}function rn(r,e){const t=r[e];return t?Object.keys(t).map(s=>[s,t[s]]):[]}class nn{constructor(e,t){this.started=!1,this.context=e,this.delegate=t,this.outletsByName=new G,this.outletElementsByName=new G,this.selectorObserverMap=new Map,this.attributeObserverMap=new Map}start(){this.started||(this.outletDefinitions.forEach(e=>{this.setupSelectorObserverForOutlet(e),this.setupAttributeObserverForOutlet(e)}),this.started=!0,this.dependentContexts.forEach(e=>e.refresh()))}refresh(){this.selectorObserverMap.forEach(e=>e.refresh()),this.attributeObserverMap.forEach(e=>e.refresh())}stop(){this.started&&(this.started=!1,this.disconnectAllOutlets(),this.stopSelectorObservers(),this.stopAttributeObservers())}stopSelectorObservers(){this.selectorObserverMap.size>0&&(this.selectorObserverMap.forEach(e=>e.stop()),this.selectorObserverMap.clear())}stopAttributeObservers(){this.attributeObserverMap.size>0&&(this.attributeObserverMap.forEach(e=>e.stop()),this.attributeObserverMap.clear())}selectorMatched(e,t,{outletName:s}){const n=this.getOutlet(e,s);n&&this.connectOutlet(n,e,s)}selectorUnmatched(e,t,{outletName:s}){const n=this.getOutletFromMap(e,s);n&&this.disconnectOutlet(n,e,s)}selectorMatchElement(e,{outletName:t}){const s=this.selector(t),n=this.hasOutlet(e,t),i=e.matches(`[${this.schema.controllerAttribute}~=${t}]`);return s?n&&i&&e.matches(s):!1}elementMatchedAttribute(e,t){const s=this.getOutletNameFromOutletAttributeName(t);s&&this.updateSelectorObserverForOutlet(s)}elementAttributeValueChanged(e,t){const s=this.getOutletNameFromOutletAttributeName(t);s&&this.updateSelectorObserverForOutlet(s)}elementUnmatchedAttribute(e,t){const s=this.getOutletNameFromOutletAttributeName(t);s&&this.updateSelectorObserverForOutlet(s)}connectOutlet(e,t,s){var n;this.outletElementsByName.has(s,t)||(this.outletsByName.add(s,e),this.outletElementsByName.add(s,t),(n=this.selectorObserverMap.get(s))===null||n===void 0||n.pause(()=>this.delegate.outletConnected(e,t,s)))}disconnectOutlet(e,t,s){var n;this.outletElementsByName.has(s,t)&&(this.outletsByName.delete(s,e),this.outletElementsByName.delete(s,t),(n=this.selectorObserverMap.get(s))===null||n===void 0||n.pause(()=>this.delegate.outletDisconnected(e,t,s)))}disconnectAllOutlets(){for(const e of this.outletElementsByName.keys)for(const t of this.outletElementsByName.getValuesForKey(e))for(const s of this.outletsByName.getValuesForKey(e))this.disconnectOutlet(s,t,e)}updateSelectorObserverForOutlet(e){const t=this.selectorObserverMap.get(e);t&&(t.selector=this.selector(e))}setupSelectorObserverForOutlet(e){const t=this.selector(e),s=new zr(document.body,t,this,{outletName:e});this.selectorObserverMap.set(e,s),s.start()}setupAttributeObserverForOutlet(e){const t=this.attributeNameForOutletName(e),s=new Ps(this.scope.element,t,this);this.attributeObserverMap.set(e,s),s.start()}selector(e){return this.scope.outlets.getSelectorForOutletName(e)}attributeNameForOutletName(e){return this.scope.schema.outletAttributeForScope(this.identifier,e)}getOutletNameFromOutletAttributeName(e){return this.outletDefinitions.find(t=>this.attributeNameForOutletName(t)===e)}get outletDependencies(){const e=new G;return this.router.modules.forEach(t=>{const s=t.definition.controllerConstructor;Fe(s,"outlets").forEach(i=>e.add(i,t.identifier))}),e}get outletDefinitions(){return this.outletDependencies.getKeysForValue(this.identifier)}get dependentControllerIdentifiers(){return this.outletDependencies.getValuesForKey(this.identifier)}get dependentContexts(){const e=this.dependentControllerIdentifiers;return this.router.contexts.filter(t=>e.includes(t.identifier))}hasOutlet(e,t){return!!this.getOutlet(e,t)||!!this.getOutletFromMap(e,t)}getOutlet(e,t){return this.application.getControllerForElementAndIdentifier(e,t)}getOutletFromMap(e,t){return this.outletsByName.getValuesForKey(t).find(s=>s.element===e)}get scope(){return this.context.scope}get schema(){return this.context.schema}get identifier(){return this.context.identifier}get application(){return this.context.application}get router(){return this.application.router}}class on{constructor(e,t){this.logDebugActivity=(s,n={})=>{const{identifier:i,controller:o,element:a}=this;n=Object.assign({identifier:i,controller:o,element:a},n),this.application.logDebugActivity(this.identifier,s,n)},this.module=e,this.scope=t,this.controller=new e.controllerConstructor(this),this.bindingObserver=new Qr(this,this.dispatcher),this.valueObserver=new Zr(this,this.controller),this.targetObserver=new en(this,this),this.outletObserver=new nn(this,this);try{this.controller.initialize(),this.logDebugActivity("initialize")}catch(s){this.handleError(s,"initializing controller")}}connect(){this.bindingObserver.start(),this.valueObserver.start(),this.targetObserver.start(),this.outletObserver.start();try{this.controller.connect(),this.logDebugActivity("connect")}catch(e){this.handleError(e,"connecting controller")}}refresh(){this.outletObserver.refresh()}disconnect(){try{this.controller.disconnect(),this.logDebugActivity("disconnect")}catch(e){this.handleError(e,"disconnecting controller")}this.outletObserver.stop(),this.targetObserver.stop(),this.valueObserver.stop(),this.bindingObserver.stop()}get application(){return this.module.application}get identifier(){return this.module.identifier}get schema(){return this.application.schema}get dispatcher(){return this.application.dispatcher}get element(){return this.scope.element}get parentElement(){return this.element.parentElement}handleError(e,t,s={}){const{identifier:n,controller:i,element:o}=this;s=Object.assign({identifier:n,controller:i,element:o},s),this.application.handleError(e,`Error ${t}`,s)}targetConnected(e,t){this.invokeControllerMethod(`${t}TargetConnected`,e)}targetDisconnected(e,t){this.invokeControllerMethod(`${t}TargetDisconnected`,e)}outletConnected(e,t,s){this.invokeControllerMethod(`${It(s)}OutletConnected`,e,t)}outletDisconnected(e,t,s){this.invokeControllerMethod(`${It(s)}OutletDisconnected`,e,t)}invokeControllerMethod(e,...t){const s=this.controller;typeof s[e]=="function"&&s[e](...t)}}function an(r){return cn(r,ln(r))}function cn(r,e){const t=fn(r),s=hn(r.prototype,e);return Object.defineProperties(t.prototype,s),t}function ln(r){return Fe(r,"blessings").reduce((t,s)=>{const n=s(r);for(const i in n){const o=t[i]||{};t[i]=Object.assign(o,n[i])}return t},{})}function hn(r,e){return dn(e).reduce((t,s)=>{const n=un(r,e,s);return n&&Object.assign(t,{[s]:n}),t},{})}function un(r,e,t){const s=Object.getOwnPropertyDescriptor(r,t);if(!(s&&"value"in s)){const i=Object.getOwnPropertyDescriptor(e,t).value;return s&&(i.get=s.get||i.get,i.set=s.set||i.set),i}}const dn=typeof Object.getOwnPropertySymbols=="function"?r=>[...Object.getOwnPropertyNames(r),...Object.getOwnPropertySymbols(r)]:Object.getOwnPropertyNames,fn=(()=>{function r(t){function s(){return Reflect.construct(t,arguments,new.target)}return s.prototype=Object.create(t.prototype,{constructor:{value:s}}),Reflect.setPrototypeOf(s,t),s}function e(){const s=r(function(){this.a.call(this)});return s.prototype.a=function(){},new s}try{return e(),r}catch{return s=>class extends s{}}})();function pn(r){return{identifier:r.identifier,controllerConstructor:an(r.controllerConstructor)}}class mn{constructor(e,t){this.application=e,this.definition=pn(t),this.contextsByScope=new WeakMap,this.connectedContexts=new Set}get identifier(){return this.definition.identifier}get controllerConstructor(){return this.definition.controllerConstructor}get contexts(){return Array.from(this.connectedContexts)}connectContextForScope(e){const t=this.fetchContextForScope(e);this.connectedContexts.add(t),t.connect()}disconnectContextForScope(e){const t=this.contextsByScope.get(e);t&&(this.connectedContexts.delete(t),t.disconnect())}fetchContextForScope(e){let t=this.contextsByScope.get(e);return t||(t=new on(this,e),this.contextsByScope.set(e,t)),t}}class gn{constructor(e){this.scope=e}has(e){return this.data.has(this.getDataKey(e))}get(e){return this.getAll(e)[0]}getAll(e){const t=this.data.get(this.getDataKey(e))||"";return Hr(t)}getAttributeName(e){return this.data.getAttributeNameForKey(this.getDataKey(e))}getDataKey(e){return`${e}-class`}get data(){return this.scope.data}}class bn{constructor(e){this.scope=e}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get(e){const t=this.getAttributeNameForKey(e);return this.element.getAttribute(t)}set(e,t){const s=this.getAttributeNameForKey(e);return this.element.setAttribute(s,t),this.get(e)}has(e){const t=this.getAttributeNameForKey(e);return this.element.hasAttribute(t)}delete(e){if(this.has(e)){const t=this.getAttributeNameForKey(e);return this.element.removeAttribute(t),!0}else return!1}getAttributeNameForKey(e){return`data-${this.identifier}-${Ms(e)}`}}class vn{constructor(e){this.warnedKeysByObject=new WeakMap,this.logger=e}warn(e,t,s){let n=this.warnedKeysByObject.get(e);n||(n=new Set,this.warnedKeysByObject.set(e,n)),n.has(t)||(n.add(t),this.logger.warn(s,e))}}function Lt(r,e){return`[${r}~="${e}"]`}class yn{constructor(e){this.scope=e}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get schema(){return this.scope.schema}has(e){return this.find(e)!=null}find(...e){return e.reduce((t,s)=>t||this.findTarget(s)||this.findLegacyTarget(s),void 0)}findAll(...e){return e.reduce((t,s)=>[...t,...this.findAllTargets(s),...this.findAllLegacyTargets(s)],[])}findTarget(e){const t=this.getSelectorForTargetName(e);return this.scope.findElement(t)}findAllTargets(e){const t=this.getSelectorForTargetName(e);return this.scope.findAllElements(t)}getSelectorForTargetName(e){const t=this.schema.targetAttributeForScope(this.identifier);return Lt(t,e)}findLegacyTarget(e){const t=this.getLegacySelectorForTargetName(e);return this.deprecate(this.scope.findElement(t),e)}findAllLegacyTargets(e){const t=this.getLegacySelectorForTargetName(e);return this.scope.findAllElements(t).map(s=>this.deprecate(s,e))}getLegacySelectorForTargetName(e){const t=`${this.identifier}.${e}`;return Lt(this.schema.targetAttribute,t)}deprecate(e,t){if(e){const{identifier:s}=this,n=this.schema.targetAttribute,i=this.schema.targetAttributeForScope(s);this.guide.warn(e,`target:${t}`,`Please replace ${n}="${s}.${t}" with ${i}="${t}". The ${n} attribute is deprecated and will be removed in a future version of Stimulus.`)}return e}get guide(){return this.scope.guide}}class wn{constructor(e,t){this.scope=e,this.controllerElement=t}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get schema(){return this.scope.schema}has(e){return this.find(e)!=null}find(...e){return e.reduce((t,s)=>t||this.findOutlet(s),void 0)}findAll(...e){return e.reduce((t,s)=>[...t,...this.findAllOutlets(s)],[])}getSelectorForOutletName(e){const t=this.schema.outletAttributeForScope(this.identifier,e);return this.controllerElement.getAttribute(t)}findOutlet(e){const t=this.getSelectorForOutletName(e);if(t)return this.findElement(t,e)}findAllOutlets(e){const t=this.getSelectorForOutletName(e);return t?this.findAllElements(t,e):[]}findElement(e,t){return this.scope.queryElements(e).filter(n=>this.matchesElement(n,e,t))[0]}findAllElements(e,t){return this.scope.queryElements(e).filter(n=>this.matchesElement(n,e,t))}matchesElement(e,t,s){const n=e.getAttribute(this.scope.schema.controllerAttribute)||"";return e.matches(t)&&n.split(" ").includes(s)}}class jt{constructor(e,t,s,n){this.targets=new yn(this),this.classes=new gn(this),this.data=new bn(this),this.containsElement=i=>i.closest(this.controllerSelector)===this.element,this.schema=e,this.element=t,this.identifier=s,this.guide=new vn(n),this.outlets=new wn(this.documentScope,t)}findElement(e){return this.element.matches(e)?this.element:this.queryElements(e).find(this.containsElement)}findAllElements(e){return[...this.element.matches(e)?[this.element]:[],...this.queryElements(e).filter(this.containsElement)]}queryElements(e){return Array.from(this.element.querySelectorAll(e))}get controllerSelector(){return Lt(this.schema.controllerAttribute,this.identifier)}get isDocumentScope(){return this.element===document.documentElement}get documentScope(){return this.isDocumentScope?this:new jt(this.schema,document.documentElement,this.identifier,this.guide.logger)}}class Sn{constructor(e,t,s){this.element=e,this.schema=t,this.delegate=s,this.valueListObserver=new Fs(this.element,this.controllerAttribute,this),this.scopesByIdentifierByElement=new WeakMap,this.scopeReferenceCounts=new WeakMap}start(){this.valueListObserver.start()}stop(){this.valueListObserver.stop()}get controllerAttribute(){return this.schema.controllerAttribute}parseValueForToken(e){const{element:t,content:s}=e;return this.parseValueForElementAndIdentifier(t,s)}parseValueForElementAndIdentifier(e,t){const s=this.fetchScopesByIdentifierForElement(e);let n=s.get(t);return n||(n=this.delegate.createScopeForElementAndIdentifier(e,t),s.set(t,n)),n}elementMatchedValue(e,t){const s=(this.scopeReferenceCounts.get(t)||0)+1;this.scopeReferenceCounts.set(t,s),s==1&&this.delegate.scopeConnected(t)}elementUnmatchedValue(e,t){const s=this.scopeReferenceCounts.get(t);s&&(this.scopeReferenceCounts.set(t,s-1),s==1&&this.delegate.scopeDisconnected(t))}fetchScopesByIdentifierForElement(e){let t=this.scopesByIdentifierByElement.get(e);return t||(t=new Map,this.scopesByIdentifierByElement.set(e,t)),t}}class _n{constructor(e){this.application=e,this.scopeObserver=new Sn(this.element,this.schema,this),this.scopesByIdentifier=new G,this.modulesByIdentifier=new Map}get element(){return this.application.element}get schema(){return this.application.schema}get logger(){return this.application.logger}get controllerAttribute(){return this.schema.controllerAttribute}get modules(){return Array.from(this.modulesByIdentifier.values())}get contexts(){return this.modules.reduce((e,t)=>e.concat(t.contexts),[])}start(){this.scopeObserver.start()}stop(){this.scopeObserver.stop()}loadDefinition(e){this.unloadIdentifier(e.identifier);const t=new mn(this.application,e);this.connectModule(t);const s=e.controllerConstructor.afterLoad;s&&s.call(e.controllerConstructor,e.identifier,this.application)}unloadIdentifier(e){const t=this.modulesByIdentifier.get(e);t&&this.disconnectModule(t)}getContextForElementAndIdentifier(e,t){const s=this.modulesByIdentifier.get(t);if(s)return s.contexts.find(n=>n.element==e)}proposeToConnectScopeForElementAndIdentifier(e,t){const s=this.scopeObserver.parseValueForElementAndIdentifier(e,t);s?this.scopeObserver.elementMatchedValue(s.element,s):console.error(`Couldn't find or create scope for identifier: "${t}" and element:`,e)}handleError(e,t,s){this.application.handleError(e,t,s)}createScopeForElementAndIdentifier(e,t){return new jt(this.schema,e,t,this.logger)}scopeConnected(e){this.scopesByIdentifier.add(e.identifier,e);const t=this.modulesByIdentifier.get(e.identifier);t&&t.connectContextForScope(e)}scopeDisconnected(e){this.scopesByIdentifier.delete(e.identifier,e);const t=this.modulesByIdentifier.get(e.identifier);t&&t.disconnectContextForScope(e)}connectModule(e){this.modulesByIdentifier.set(e.identifier,e),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach(s=>e.connectContextForScope(s))}disconnectModule(e){this.modulesByIdentifier.delete(e.identifier),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach(s=>e.disconnectContextForScope(s))}}const En={controllerAttribute:"data-controller",actionAttribute:"data-action",targetAttribute:"data-target",targetAttributeForScope:r=>`data-${r}-target`,outletAttributeForScope:(r,e)=>`data-${r}-${e}-outlet`,keyMappings:Object.assign(Object.assign({enter:"Enter",tab:"Tab",esc:"Escape",space:" ",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",home:"Home",end:"End",page_up:"PageUp",page_down:"PageDown"},ls("abcdefghijklmnopqrstuvwxyz".split("").map(r=>[r,r]))),ls("0123456789".split("").map(r=>[r,r])))};function ls(r){return r.reduce((e,[t,s])=>Object.assign(Object.assign({},e),{[t]:s}),{})}class Cn{constructor(e=document.documentElement,t=En){this.logger=console,this.debug=!1,this.logDebugActivity=(s,n,i={})=>{this.debug&&this.logFormattedMessage(s,n,i)},this.element=e,this.schema=t,this.dispatcher=new Lr(this),this.router=new _n(this),this.actionDescriptorFilters=Object.assign({},Or)}static start(e,t){const s=new this(e,t);return s.start(),s}async start(){await Tn(),this.logDebugActivity("application","starting"),this.dispatcher.start(),this.router.start(),this.logDebugActivity("application","start")}stop(){this.logDebugActivity("application","stopping"),this.dispatcher.stop(),this.router.stop(),this.logDebugActivity("application","stop")}register(e,t){this.load({identifier:e,controllerConstructor:t})}registerActionOption(e,t){this.actionDescriptorFilters[e]=t}load(e,...t){(Array.isArray(e)?e:[e,...t]).forEach(n=>{n.controllerConstructor.shouldLoad&&this.router.loadDefinition(n)})}unload(e,...t){(Array.isArray(e)?e:[e,...t]).forEach(n=>this.router.unloadIdentifier(n))}get controllers(){return this.router.contexts.map(e=>e.controller)}getControllerForElementAndIdentifier(e,t){const s=this.router.getContextForElementAndIdentifier(e,t);return s?s.controller:null}handleError(e,t,s){var n;this.logger.error(`%s

%o

%o`,t,e,s),(n=window.onerror)===null||n===void 0||n.call(window,t,"",0,0,e)}logFormattedMessage(e,t,s={}){s=Object.assign({application:this},s),this.logger.groupCollapsed(`${e} #${t}`),this.logger.log("details:",Object.assign({},s)),this.logger.groupEnd()}}function Tn(){return new Promise(r=>{document.readyState=="loading"?document.addEventListener("DOMContentLoaded",()=>r()):r()})}function An(r){return Fe(r,"classes").reduce((t,s)=>Object.assign(t,kn(s)),{})}function kn(r){return{[`${r}Class`]:{get(){const{classes:e}=this;if(e.has(r))return e.get(r);{const t=e.getAttributeName(r);throw new Error(`Missing attribute "${t}"`)}}},[`${r}Classes`]:{get(){return this.classes.getAll(r)}},[`has${Oe(r)}Class`]:{get(){return this.classes.has(r)}}}}function Rn(r){return Fe(r,"outlets").reduce((t,s)=>Object.assign(t,Mn(s)),{})}function hs(r,e,t){return r.application.getControllerForElementAndIdentifier(e,t)}function us(r,e,t){let s=hs(r,e,t);if(s||(r.application.router.proposeToConnectScopeForElementAndIdentifier(e,t),s=hs(r,e,t),s))return s}function Mn(r){const e=It(r);return{[`${e}Outlet`]:{get(){const t=this.outlets.find(r),s=this.outlets.getSelectorForOutletName(r);if(t){const n=us(this,t,r);if(n)return n;throw new Error(`The provided outlet element is missing an outlet controller "${r}" instance for host controller "${this.identifier}"`)}throw new Error(`Missing outlet element "${r}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${s}".`)}},[`${e}Outlets`]:{get(){const t=this.outlets.findAll(r);return t.length>0?t.map(s=>{const n=us(this,s,r);if(n)return n;console.warn(`The provided outlet element is missing an outlet controller "${r}" instance for host controller "${this.identifier}"`,s)}).filter(s=>s):[]}},[`${e}OutletElement`]:{get(){const t=this.outlets.find(r),s=this.outlets.getSelectorForOutletName(r);if(t)return t;throw new Error(`Missing outlet element "${r}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${s}".`)}},[`${e}OutletElements`]:{get(){return this.outlets.findAll(r)}},[`has${Oe(e)}Outlet`]:{get(){return this.outlets.has(r)}}}}function In(r){return Fe(r,"targets").reduce((t,s)=>Object.assign(t,Pn(s)),{})}function Pn(r){return{[`${r}Target`]:{get(){const e=this.targets.find(r);if(e)return e;throw new Error(`Missing target element "${r}" for "${this.identifier}" controller`)}},[`${r}Targets`]:{get(){return this.targets.findAll(r)}},[`has${Oe(r)}Target`]:{get(){return this.targets.has(r)}}}}function Ln(r){const e=tn(r,"values"),t={valueDescriptorMap:{get(){return e.reduce((s,n)=>{const i=Bs(n,this.identifier),o=this.data.getAttributeNameForKey(i.key);return Object.assign(s,{[o]:i})},{})}}};return e.reduce((s,n)=>Object.assign(s,On(n)),t)}function On(r,e){const t=Bs(r,e),{key:s,name:n,reader:i,writer:o}=t;return{[n]:{get(){const a=this.data.get(s);return a!==null?i(a):t.defaultValue},set(a){a===void 0?this.data.delete(s):this.data.set(s,o(a))}},[`has${Oe(n)}`]:{get(){return this.data.has(s)||t.hasCustomDefaultValue}}}}function Bs([r,e],t){return Nn({controller:t,token:r,typeDefinition:e})}function Xe(r){switch(r){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function ye(r){switch(typeof r){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}if(Array.isArray(r))return"array";if(Object.prototype.toString.call(r)==="[object Object]")return"object"}function Fn(r){const{controller:e,token:t,typeObject:s}=r,n=os(s.type),i=os(s.default),o=n&&i,a=n&&!i,l=!n&&i,u=Xe(s.type),d=ye(r.typeObject.default);if(a)return u;if(l)return d;if(u!==d){const b=e?`${e}.${t}`:t;throw new Error(`The specified default value for the Stimulus Value "${b}" must match the defined type "${u}". The provided default value of "${s.default}" is of type "${d}".`)}if(o)return u}function Dn(r){const{controller:e,token:t,typeDefinition:s}=r,i=Fn({controller:e,token:t,typeObject:s}),o=ye(s),a=Xe(s),l=i||o||a;if(l)return l;const u=e?`${e}.${s}`:t;throw new Error(`Unknown value type "${u}" for "${t}" value`)}function Bn(r){const e=Xe(r);if(e)return ds[e];const t=Pt(r,"default"),s=Pt(r,"type"),n=r;if(t)return n.default;if(s){const{type:i}=n,o=Xe(i);if(o)return ds[o]}return r}function Nn(r){const{token:e,typeDefinition:t}=r,s=`${Ms(e)}-value`,n=Dn(r);return{type:n,key:s,name:Wt(s),get defaultValue(){return Bn(t)},get hasCustomDefaultValue(){return ye(t)!==void 0},reader:$n[n],writer:fs[n]||fs.default}}const ds={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},$n={array(r){const e=JSON.parse(r);if(!Array.isArray(e))throw new TypeError(`expected value of type "array" but instead got value "${r}" of type "${ye(e)}"`);return e},boolean(r){return!(r=="0"||String(r).toLowerCase()=="false")},number(r){return Number(r.replace(/_/g,""))},object(r){const e=JSON.parse(r);if(e===null||typeof e!="object"||Array.isArray(e))throw new TypeError(`expected value of type "object" but instead got value "${r}" of type "${ye(e)}"`);return e},string(r){return r}},fs={default:Hn,array:ps,object:ps};function ps(r){return JSON.stringify(r)}function Hn(r){return`${r}`}class j{constructor(e){this.context=e}static get shouldLoad(){return!0}static afterLoad(e,t){}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get outlets(){return this.scope.outlets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(e,{target:t=this.element,detail:s={},prefix:n=this.identifier,bubbles:i=!0,cancelable:o=!0}={}){const a=n?`${n}:${e}`:e,l=new CustomEvent(a,{detail:s,bubbles:i,cancelable:o});return t.dispatchEvent(l),l}}j.blessings=[An,In,Ln,Rn];j.targets=[];j.outlets=[];j.values={};class xn extends j{connect(){this.sayHi("foo")}sayHi(e){console.log(`Hello from the '${e}' controller.`,this.element)}}const qn=Object.freeze(Object.defineProperty({__proto__:null,default:xn},Symbol.toStringTag,{value:"Module"}));class qe extends j{connect(){this.sayHi("hello"),this.styleUsername()}sayHi(e){console.log(`Hello from the '${e}' controller.`,this.element)}greet(e){console.log("Hello from element:",this.element,e.target),this.hasUsernameTarget&&console.log(`Greetings ${this.usernameTarget.value?this.usernameTarget.value:"no one"}!`),this.counterValue++}counterValueChanged(e,t){console.log(`Greeting count is ${e}`)}usernameChange(e){this.styleUsername()}styleUsername(){this.usernameTarget.value?this.usernameTarget.classList.remove(...this.emptyClasses):this.usernameTarget.classList.add(...this.emptyClasses)}}h(qe,"targets",["username"]),h(qe,"values",{counter:Number}),h(qe,"classes",["empty"]);const Vn=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"}));class Ns extends j{select(e){const t=e.currentTarget.innerText;this.dispatch("selected",{detail:{value:t}}),this.the_listTarget.innerHTML=""}}h(Ns,"targets",["the_list"]);const Wn=Object.freeze(Object.defineProperty({__proto__:null,default:Ns},Symbol.toStringTag,{value:"Module"}));class $s extends j{clear(){this.the_inputTarget.value=""}selected(e){const{value:t}=e.detail;this.the_inputTarget.value=t}query(){clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.the_inputTarget.value.length>1&&this.the_submitTarget.click()},500)}}h($s,"targets",["the_input","the_submit"]);const jn=Object.freeze(Object.defineProperty({__proto__:null,default:$s},Symbol.toStringTag,{value:"Module"}));/*!
Turbo 8.0.0-beta.1
Copyright Â© 2023 37signals LLC
 */(function(r){if(typeof r.requestSubmit=="function")return;r.requestSubmit=function(s){s?(e(s,this),s.click()):(s=document.createElement("input"),s.type="submit",s.hidden=!0,this.appendChild(s),s.click(),this.removeChild(s))};function e(s,n){s instanceof HTMLElement||t(TypeError,"parameter 1 is not of type 'HTMLElement'"),s.type=="submit"||t(TypeError,"The specified element is not a submit button"),s.form==n||t(DOMException,"The specified element is not owned by this form element","NotFoundError")}function t(s,n,i){throw new s("Failed to execute 'requestSubmit' on 'HTMLFormElement': "+n+".",i)}})(HTMLFormElement.prototype);const Hs=new WeakMap;function Un(r){const e=r instanceof Element?r:r instanceof Node?r.parentElement:null,t=e?e.closest("input, button"):null;return(t==null?void 0:t.type)=="submit"?t:null}function Kn(r){const e=Un(r.target);e&&e.form&&Hs.set(e.form,e)}(function(){if("submitter"in Event.prototype)return;let r=window.Event.prototype;if("SubmitEvent"in window){const e=window.SubmitEvent.prototype;if(/Apple Computer/.test(navigator.vendor)&&!("submitter"in e))r=e;else return}addEventListener("click",Kn,!0),Object.defineProperty(r,"submitter",{get(){if(this.type=="submit"&&this.target instanceof HTMLFormElement)return Hs.get(this.target)}})})();const ne={eager:"eager",lazy:"lazy"},tt=class tt extends HTMLElement{constructor(){super();h(this,"loaded",Promise.resolve());this.delegate=new tt.delegateConstructor(this)}static get observedAttributes(){return["disabled","complete","loading","src"]}connectedCallback(){this.delegate.connect()}disconnectedCallback(){this.delegate.disconnect()}reload(){return this.delegate.sourceURLReloaded()}attributeChangedCallback(t){t=="loading"?this.delegate.loadingStyleChanged():t=="complete"?this.delegate.completeChanged():t=="src"?this.delegate.sourceURLChanged():this.delegate.disabledChanged()}get src(){return this.getAttribute("src")}set src(t){t?this.setAttribute("src",t):this.removeAttribute("src")}get refresh(){return this.getAttribute("refresh")}set refresh(t){t?this.setAttribute("refresh",t):this.removeAttribute("refresh")}get loading(){return zn(this.getAttribute("loading")||"")}set loading(t){t?this.setAttribute("loading",t):this.removeAttribute("loading")}get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}get autoscroll(){return this.hasAttribute("autoscroll")}set autoscroll(t){t?this.setAttribute("autoscroll",""):this.removeAttribute("autoscroll")}get complete(){return!this.delegate.isLoading}get isActive(){return this.ownerDocument===document&&!this.isPreview}get isPreview(){var t,s;return(s=(t=this.ownerDocument)==null?void 0:t.documentElement)==null?void 0:s.hasAttribute("data-turbo-preview")}};h(tt,"delegateConstructor");let N=tt;function zn(r){switch(r.toLowerCase()){case"lazy":return ne.lazy;default:return ne.eager}}function T(r){return new URL(r.toString(),document.baseURI)}function Y(r){let e;if(r.hash)return r.hash.slice(1);if(e=r.href.match(/#(.*)$/))return e[1]}function Ut(r,e){const t=(e==null?void 0:e.getAttribute("formaction"))||r.getAttribute("action")||r.action;return T(t)}function Jn(r){return(Zn(r).match(/\.[^.]*$/)||[])[0]||""}function Xn(r){return!!Jn(r).match(/^(?:|\.(?:htm|html|xhtml|php))$/)}function Gn(r,e){const t=ei(e);return r.href===T(t).href||r.href.startsWith(t)}function ie(r,e){return Gn(r,e)&&Xn(r)}function Ot(r){const e=Y(r);return e!=null?r.href.slice(0,-(e.length+1)):r.href}function Ne(r){return Ot(r)}function Yn(r,e){return T(r).href==T(e).href}function Qn(r){return r.pathname.split("/").slice(1)}function Zn(r){return Qn(r).slice(-1)[0]}function ei(r){return ti(r.origin+r.pathname)}function ti(r){return r.endsWith("/")?r:r+"/"}class Kt{constructor(e){this.response=e}get succeeded(){return this.response.ok}get failed(){return!this.succeeded}get clientError(){return this.statusCode>=400&&this.statusCode<=499}get serverError(){return this.statusCode>=500&&this.statusCode<=599}get redirected(){return this.response.redirected}get location(){return T(this.response.url)}get isHTML(){return this.contentType&&this.contentType.match(/^(?:text\/([^\s;,]+\b)?html|application\/xhtml\+xml)\b/)}get statusCode(){return this.response.status}get contentType(){return this.header("Content-Type")}get responseText(){return this.response.clone().text()}get responseHTML(){return this.isHTML?this.response.clone().text():Promise.resolve(void 0)}header(e){return this.response.headers.get(e)}}function we(r){if(r.getAttribute("data-turbo-eval")=="false")return r;{const e=document.createElement("script"),t=Ye("csp-nonce");return t&&(e.nonce=t),e.textContent=r.textContent,e.async=!1,si(e,r),e}}function si(r,e){for(const{name:t,value:s}of e.attributes)r.setAttribute(t,s)}function ri(r){const e=document.createElement("template");return e.innerHTML=r,e.content}function E(r,{target:e,cancelable:t,detail:s}={}){const n=new CustomEvent(r,{cancelable:t,bubbles:!0,composed:!0,detail:s});return e&&e.isConnected?e.dispatchEvent(n):document.documentElement.dispatchEvent(n),n}function ni(){return document.visibilityState==="hidden"?xs():oe()}function oe(){return new Promise(r=>requestAnimationFrame(()=>r()))}function xs(){return new Promise(r=>setTimeout(()=>r(),0))}function ii(){return Promise.resolve()}function qs(r=""){return new DOMParser().parseFromString(r,"text/html")}function Vs(r,...e){const t=oi(r,e).replace(/^\n/,"").split(`
`),s=t[0].match(/^\s+/),n=s?s[0].length:0;return t.map(i=>i.slice(n)).join(`
`)}function oi(r,e){return r.reduce((t,s,n)=>{const i=e[n]==null?"":e[n];return t+s+i},"")}function W(){return Array.from({length:36}).map((r,e)=>e==8||e==13||e==18||e==23?"-":e==14?"4":e==19?(Math.floor(Math.random()*4)+8).toString(16):Math.floor(Math.random()*15).toString(16)).join("")}function Ge(r,...e){for(const t of e.map(s=>s==null?void 0:s.getAttribute(r)))if(typeof t=="string")return t;return null}function ai(r,...e){return e.some(t=>t&&t.hasAttribute(r))}function Ft(...r){for(const e of r)e.localName=="turbo-frame"&&e.setAttribute("busy",""),e.setAttribute("aria-busy","true")}function Dt(...r){for(const e of r)e.localName=="turbo-frame"&&e.removeAttribute("busy"),e.removeAttribute("aria-busy")}function ci(r,e=2e3){return new Promise(t=>{const s=()=>{r.removeEventListener("error",s),r.removeEventListener("load",s),t()};r.addEventListener("load",s,{once:!0}),r.addEventListener("error",s,{once:!0}),setTimeout(t,e)})}function Ws(r){switch(r){case"replace":return history.replaceState;case"advance":case"restore":return history.pushState}}function li(r){return r=="advance"||r=="replace"||r=="restore"}function Ct(...r){const e=Ge("data-turbo-action",...r);return li(e)?e:null}function js(r){return document.querySelector(`meta[name="${r}"]`)}function Ye(r){const e=js(r);return e&&e.content}function hi(r,e){let t=js(r);return t||(t=document.createElement("meta"),t.setAttribute("name",r),document.head.appendChild(t)),t.setAttribute("content",e),t}function Qe(r,e){var t;if(r instanceof Element)return r.closest(e)||Qe(r.assignedSlot||((t=r.getRootNode())==null?void 0:t.host),e)}function zt(r){const e="[inert], :disabled, [hidden], details:not([open]), dialog:not([open])";return!!r&&r.closest(e)==null&&typeof r.focus=="function"}function Us(r){return Array.from(r.querySelectorAll("[autofocus]")).find(zt)}async function ui(r,e){const t=e();r(),await oe();const s=e();return[t,s]}function Jt(r,e={}){const t=new Headers(e.headers||{}),s=W();return window.Turbo.session.recentRequests.add(s),t.append("X-Turbo-Request-Id",s),window.fetch(r,{...e,headers:t})}function Xt(r){switch(r.toLowerCase()){case"get":return L.get;case"post":return L.post;case"put":return L.put;case"patch":return L.patch;case"delete":return L.delete}}const L={get:"get",post:"post",put:"put",patch:"patch",delete:"delete"};function di(r){switch(r.toLowerCase()){case z.multipart:return z.multipart;case z.plain:return z.plain;default:return z.urlEncoded}}const z={urlEncoded:"application/x-www-form-urlencoded",multipart:"multipart/form-data",plain:"text/plain"};var Ce,st,Ks,rt,zs;class Gt{constructor(e,t,s,n=new URLSearchParams,i=null,o=z.urlEncoded){p(this,st);p(this,rt);h(this,"abortController",new AbortController);p(this,Ce,e=>{});var u;const[a,l]=ms(T(s),t,n,o);this.delegate=e,this.url=a,this.target=i,this.fetchOptions={credentials:"same-origin",redirect:"follow",method:t,headers:{...this.defaultHeaders},body:l,signal:this.abortSignal,referrer:(u=this.delegate.referrer)==null?void 0:u.href},this.enctype=o}get method(){return this.fetchOptions.method}set method(e){const t=this.isSafe?this.url.searchParams:this.fetchOptions.body||new FormData,s=Xt(e)||L.get;this.url.search="";const[n,i]=ms(this.url,s,t,this.enctype);this.url=n,this.fetchOptions.body=i,this.fetchOptions.method=s}get headers(){return this.fetchOptions.headers}set headers(e){this.fetchOptions.headers=e}get body(){return this.isSafe?this.url.searchParams:this.fetchOptions.body}set body(e){this.fetchOptions.body=e}get location(){return this.url}get params(){return this.url.searchParams}get entries(){return this.body?Array.from(this.body.entries()):[]}cancel(){this.abortController.abort()}async perform(){const{fetchOptions:e}=this;this.delegate.prepareRequest(this),await f(this,st,Ks).call(this,e);try{this.delegate.requestStarted(this);const t=await Jt(this.url.href,e);return await this.receive(t)}catch(t){if(t.name!=="AbortError")throw f(this,rt,zs).call(this,t)&&this.delegate.requestErrored(this,t),t}finally{this.delegate.requestFinished(this)}}async receive(e){const t=new Kt(e);return E("turbo:before-fetch-response",{cancelable:!0,detail:{fetchResponse:t},target:this.target}).defaultPrevented?this.delegate.requestPreventedHandlingResponse(this,t):t.succeeded?this.delegate.requestSucceededWithResponse(this,t):this.delegate.requestFailedWithResponse(this,t),t}get defaultHeaders(){return{Accept:"text/html, application/xhtml+xml"}}get isSafe(){return Yt(this.method)}get abortSignal(){return this.abortController.signal}acceptResponseType(e){this.headers.Accept=[e,this.headers.Accept].join(", ")}}Ce=new WeakMap,st=new WeakSet,Ks=async function(e){const t=new Promise(n=>C(this,Ce,n)),s=E("turbo:before-fetch-request",{cancelable:!0,detail:{fetchOptions:e,url:this.url,resume:g(this,Ce)},target:this.target});this.url=s.detail.url,s.defaultPrevented&&await t},rt=new WeakSet,zs=function(e){return!E("turbo:fetch-request-error",{target:this.target,cancelable:!0,detail:{request:this,error:e}}).defaultPrevented};function Yt(r){return Xt(r)==L.get}function ms(r,e,t,s){const n=Array.from(t).length>0?new URLSearchParams(Js(t)):r.searchParams;return Yt(e)?[fi(r,n),null]:s==z.urlEncoded?[r,n]:[r,t]}function Js(r){const e=[];for(const[t,s]of r)s instanceof File||e.push([t,s]);return e}function fi(r,e){const t=new URLSearchParams(Js(e));return r.search=t.toString(),r}class pi{constructor(e,t){h(this,"started",!1);h(this,"intersect",e=>{const t=e.slice(-1)[0];t!=null&&t.isIntersecting&&this.delegate.elementAppearedInViewport(this.element)});this.delegate=e,this.element=t,this.intersectionObserver=new IntersectionObserver(this.intersect)}start(){this.started||(this.started=!0,this.intersectionObserver.observe(this.element))}stop(){this.started&&(this.started=!1,this.intersectionObserver.unobserve(this.element))}}class te{static wrap(e){return typeof e=="string"?new this(ri(e)):e}constructor(e){this.fragment=mi(e)}}h(te,"contentType","text/vnd.turbo-stream.html");function mi(r){for(const e of r.querySelectorAll("turbo-stream")){const t=document.importNode(e,!0);for(const s of t.templateElement.content.querySelectorAll("script"))s.replaceWith(we(s));e.replaceWith(t)}return r}const se={initialized:"initialized",requesting:"requesting",waiting:"waiting",receiving:"receiving",stopping:"stopping",stopped:"stopped"};class De{constructor(e,t,s,n=!1){h(this,"state",se.initialized);const i=Si(t,s),o=wi(yi(t,s),i),a=gi(t,s),l=_i(t,s);this.delegate=e,this.formElement=t,this.submitter=s,this.fetchRequest=new Gt(this,i,o,a,t,l),this.mustRedirect=n}static confirmMethod(e,t,s){return Promise.resolve(confirm(e))}get method(){return this.fetchRequest.method}set method(e){this.fetchRequest.method=e}get action(){return this.fetchRequest.url.toString()}set action(e){this.fetchRequest.url=T(e)}get body(){return this.fetchRequest.body}get enctype(){return this.fetchRequest.enctype}get isSafe(){return this.fetchRequest.isSafe}get location(){return this.fetchRequest.url}async start(){const{initialized:e,requesting:t}=se,s=Ge("data-turbo-confirm",this.submitter,this.formElement);if(!(typeof s=="string"&&!await De.confirmMethod(s,this.formElement,this.submitter))&&this.state==e)return this.state=t,this.fetchRequest.perform()}stop(){const{stopping:e,stopped:t}=se;if(this.state!=e&&this.state!=t)return this.state=e,this.fetchRequest.cancel(),!0}prepareRequest(e){if(!e.isSafe){const t=bi(Ye("csrf-param"))||Ye("csrf-token");t&&(e.headers["X-CSRF-Token"]=t)}this.requestAcceptsTurboStreamResponse(e)&&e.acceptResponseType(te.contentType)}requestStarted(e){var t;this.state=se.waiting,(t=this.submitter)==null||t.setAttribute("disabled",""),this.setSubmitsWith(),E("turbo:submit-start",{target:this.formElement,detail:{formSubmission:this}}),this.delegate.formSubmissionStarted(this)}requestPreventedHandlingResponse(e,t){this.result={success:t.succeeded,fetchResponse:t}}requestSucceededWithResponse(e,t){if(t.clientError||t.serverError)this.delegate.formSubmissionFailedWithResponse(this,t);else if(this.requestMustRedirect(e)&&vi(t)){const s=new Error("Form responses must redirect to another location");this.delegate.formSubmissionErrored(this,s)}else this.state=se.receiving,this.result={success:!0,fetchResponse:t},this.delegate.formSubmissionSucceededWithResponse(this,t)}requestFailedWithResponse(e,t){this.result={success:!1,fetchResponse:t},this.delegate.formSubmissionFailedWithResponse(this,t)}requestErrored(e,t){this.result={success:!1,error:t},this.delegate.formSubmissionErrored(this,t)}requestFinished(e){var t;this.state=se.stopped,(t=this.submitter)==null||t.removeAttribute("disabled"),this.resetSubmitterText(),E("turbo:submit-end",{target:this.formElement,detail:{formSubmission:this,...this.result}}),this.delegate.formSubmissionFinished(this)}setSubmitsWith(){if(!(!this.submitter||!this.submitsWith)){if(this.submitter.matches("button"))this.originalSubmitText=this.submitter.innerHTML,this.submitter.innerHTML=this.submitsWith;else if(this.submitter.matches("input")){const e=this.submitter;this.originalSubmitText=e.value,e.value=this.submitsWith}}}resetSubmitterText(){if(!(!this.submitter||!this.originalSubmitText)){if(this.submitter.matches("button"))this.submitter.innerHTML=this.originalSubmitText;else if(this.submitter.matches("input")){const e=this.submitter;e.value=this.originalSubmitText}}}requestMustRedirect(e){return!e.isSafe&&this.mustRedirect}requestAcceptsTurboStreamResponse(e){return!e.isSafe||ai("data-turbo-stream",this.submitter,this.formElement)}get submitsWith(){var e;return(e=this.submitter)==null?void 0:e.getAttribute("data-turbo-submits-with")}}function gi(r,e){const t=new FormData(r),s=e==null?void 0:e.getAttribute("name"),n=e==null?void 0:e.getAttribute("value");return s&&t.append(s,n||""),t}function bi(r){if(r!=null){const t=(document.cookie?document.cookie.split("; "):[]).find(s=>s.startsWith(r));if(t){const s=t.split("=").slice(1).join("=");return s?decodeURIComponent(s):void 0}}}function vi(r){return r.statusCode==200&&!r.redirected}function yi(r,e){const t=typeof r.action=="string"?r.action:null;return e!=null&&e.hasAttribute("formaction")?e.getAttribute("formaction")||"":r.getAttribute("action")||t||""}function wi(r,e){const t=T(r);return Yt(e)&&(t.search=""),t}function Si(r,e){const t=(e==null?void 0:e.getAttribute("formmethod"))||r.getAttribute("method")||"";return Xt(t.toLowerCase())||L.get}function _i(r,e){return di((e==null?void 0:e.getAttribute("formenctype"))||r.enctype)}class Tt{constructor(e){this.element=e}get activeElement(){return this.element.ownerDocument.activeElement}get children(){return[...this.element.children]}hasAnchor(e){return this.getElementForAnchor(e)!=null}getElementForAnchor(e){return e?this.element.querySelector(`[id='${e}'], a[name='${e}']`):null}get isConnected(){return this.element.isConnected}get firstAutofocusableElement(){return Us(this.element)}get permanentElements(){return Gs(this.element)}getPermanentElementById(e){return Xs(this.element,e)}getPermanentElementMapForSnapshot(e){const t={};for(const s of this.permanentElements){const{id:n}=s,i=e.getPermanentElementById(n);i&&(t[n]=[s,i])}return t}}function Xs(r,e){return r.querySelector(`#${e}[data-turbo-permanent]`)}function Gs(r){return r.querySelectorAll("[id][data-turbo-permanent]")}class Qt{constructor(e,t){h(this,"started",!1);h(this,"submitCaptured",()=>{this.eventTarget.removeEventListener("submit",this.submitBubbled,!1),this.eventTarget.addEventListener("submit",this.submitBubbled,!1)});h(this,"submitBubbled",e=>{if(!e.defaultPrevented){const t=e.target instanceof HTMLFormElement?e.target:void 0,s=e.submitter||void 0;t&&Ei(t,s)&&Ci(t,s)&&this.delegate.willSubmitForm(t,s)&&(e.preventDefault(),e.stopImmediatePropagation(),this.delegate.formSubmitted(t,s))}});this.delegate=e,this.eventTarget=t}start(){this.started||(this.eventTarget.addEventListener("submit",this.submitCaptured,!0),this.started=!0)}stop(){this.started&&(this.eventTarget.removeEventListener("submit",this.submitCaptured,!0),this.started=!1)}}function Ei(r,e){return((e==null?void 0:e.getAttribute("formmethod"))||r.getAttribute("method"))!="dialog"}function Ci(r,e){if(e!=null&&e.hasAttribute("formtarget")||r.hasAttribute("target")){const t=(e==null?void 0:e.getAttribute("formtarget"))||r.target;for(const s of document.getElementsByName(t))if(s instanceof HTMLIFrameElement)return!1;return!0}else return!0}var Te,Ae;class Ys{constructor(e,t){p(this,Te,e=>{});p(this,Ae,e=>{});this.delegate=e,this.element=t}scrollToAnchor(e){const t=this.snapshot.getElementForAnchor(e);t?(this.scrollToElement(t),this.focusElement(t)):this.scrollToPosition({x:0,y:0})}scrollToAnchorFromLocation(e){this.scrollToAnchor(Y(e))}scrollToElement(e){e.scrollIntoView()}focusElement(e){e instanceof HTMLElement&&(e.hasAttribute("tabindex")?e.focus():(e.setAttribute("tabindex","-1"),e.focus(),e.removeAttribute("tabindex")))}scrollToPosition({x:e,y:t}){this.scrollRoot.scrollTo(e,t)}scrollToTop(){this.scrollToPosition({x:0,y:0})}get scrollRoot(){return window}async render(e){const{isPreview:t,shouldRender:s,newSnapshot:n}=e;if(s)try{this.renderPromise=new Promise(l=>C(this,Te,l)),this.renderer=e,await this.prepareToRenderSnapshot(e);const i=new Promise(l=>C(this,Ae,l)),o={resume:g(this,Ae),render:this.renderer.renderElement};this.delegate.allowsImmediateRender(n,t,o)||await i,await this.renderSnapshot(e),this.delegate.viewRenderedSnapshot(n,t,this.renderer.renderMethod),this.delegate.preloadOnLoadLinksForView(this.element),this.finishRenderingSnapshot(e)}finally{delete this.renderer,g(this,Te).call(this,void 0),delete this.renderPromise}else this.invalidate(e.reloadReason)}invalidate(e){this.delegate.viewInvalidated(e)}async prepareToRenderSnapshot(e){this.markAsPreview(e.isPreview),await e.prepareToRender()}markAsPreview(e){e?this.element.setAttribute("data-turbo-preview",""):this.element.removeAttribute("data-turbo-preview")}async renderSnapshot(e){await e.render()}finishRenderingSnapshot(e){e.finishRendering()}}Te=new WeakMap,Ae=new WeakMap;class Ti extends Ys{missing(){this.element.innerHTML='<strong class="turbo-frame-error">Content missing</strong>'}get snapshot(){return new Tt(this.element)}}class Qs{constructor(e,t){h(this,"clickBubbled",e=>{this.respondsToEventTarget(e.target)?this.clickEvent=e:delete this.clickEvent});h(this,"linkClicked",e=>{this.clickEvent&&this.respondsToEventTarget(e.target)&&e.target instanceof Element&&this.delegate.shouldInterceptLinkClick(e.target,e.detail.url,e.detail.originalEvent)&&(this.clickEvent.preventDefault(),e.preventDefault(),this.delegate.linkClickIntercepted(e.target,e.detail.url,e.detail.originalEvent)),delete this.clickEvent});h(this,"willVisit",e=>{delete this.clickEvent});this.delegate=e,this.element=t}start(){this.element.addEventListener("click",this.clickBubbled),document.addEventListener("turbo:click",this.linkClicked),document.addEventListener("turbo:before-visit",this.willVisit)}stop(){this.element.removeEventListener("click",this.clickBubbled),document.removeEventListener("turbo:click",this.linkClicked),document.removeEventListener("turbo:before-visit",this.willVisit)}respondsToEventTarget(e){const t=e instanceof Element?e:e instanceof Node?e.parentElement:null;return t&&t.closest("turbo-frame, html")==this.element}}class Zs{constructor(e,t){h(this,"started",!1);h(this,"clickCaptured",()=>{this.eventTarget.removeEventListener("click",this.clickBubbled,!1),this.eventTarget.addEventListener("click",this.clickBubbled,!1)});h(this,"clickBubbled",e=>{if(e instanceof MouseEvent&&this.clickEventIsSignificant(e)){const t=e.composedPath&&e.composedPath()[0]||e.target,s=this.findLinkFromClickTarget(t);if(s&&Ai(s)){const n=this.getLocationForLink(s);this.delegate.willFollowLinkToLocation(s,n,e)&&(e.preventDefault(),this.delegate.followedLinkToLocation(s,n))}}});this.delegate=e,this.eventTarget=t}start(){this.started||(this.eventTarget.addEventListener("click",this.clickCaptured,!0),this.started=!0)}stop(){this.started&&(this.eventTarget.removeEventListener("click",this.clickCaptured,!0),this.started=!1)}clickEventIsSignificant(e){return!(e.target&&e.target.isContentEditable||e.defaultPrevented||e.which>1||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)}findLinkFromClickTarget(e){return Qe(e,"a[href]:not([target^=_]):not([download])")}getLocationForLink(e){return T(e.getAttribute("href")||"")}}function Ai(r){if(r.hasAttribute("target")){for(const e of document.getElementsByName(r.target))if(e instanceof HTMLIFrameElement)return!1;return!0}else return!0}class er{constructor(e,t){this.delegate=e,this.linkInterceptor=new Zs(this,t)}start(){this.linkInterceptor.start()}stop(){this.linkInterceptor.stop()}willFollowLinkToLocation(e,t,s){return this.delegate.willSubmitFormLinkToLocation(e,t,s)&&(e.hasAttribute("data-turbo-method")||e.hasAttribute("data-turbo-stream"))}followedLinkToLocation(e,t){const s=document.createElement("form"),n="hidden";for(const[b,k]of t.searchParams)s.append(Object.assign(document.createElement("input"),{type:n,name:b,value:k}));const i=Object.assign(t,{search:""});s.setAttribute("data-turbo","true"),s.setAttribute("action",i.href),s.setAttribute("hidden","");const o=e.getAttribute("data-turbo-method");o&&s.setAttribute("method",o);const a=e.getAttribute("data-turbo-frame");a&&s.setAttribute("data-turbo-frame",a);const l=Ct(e);l&&s.setAttribute("data-turbo-action",l);const u=e.getAttribute("data-turbo-confirm");u&&s.setAttribute("data-turbo-confirm",u),e.hasAttribute("data-turbo-stream")&&s.setAttribute("data-turbo-stream",""),this.delegate.submittedFormLinkToLocation(e,t,s),document.body.appendChild(s),s.addEventListener("turbo:submit-end",()=>s.remove(),{once:!0}),requestAnimationFrame(()=>s.requestSubmit())}}class tr{static async preservingPermanentElements(e,t,s){const n=new this(e,t);n.enter(),await s(),n.leave()}constructor(e,t){this.delegate=e,this.permanentElementMap=t}enter(){for(const e in this.permanentElementMap){const[t,s]=this.permanentElementMap[e];this.delegate.enteringBardo(t,s),this.replaceNewPermanentElementWithPlaceholder(s)}}leave(){for(const e in this.permanentElementMap){const[t]=this.permanentElementMap[e];this.replaceCurrentPermanentElementWithClone(t),this.replacePlaceholderWithPermanentElement(t),this.delegate.leavingBardo(t)}}replaceNewPermanentElementWithPlaceholder(e){const t=ki(e);e.replaceWith(t)}replaceCurrentPermanentElementWithClone(e){const t=e.cloneNode(!0);e.replaceWith(t)}replacePlaceholderWithPermanentElement(e){const t=this.getPlaceholderById(e.id);t==null||t.replaceWith(e)}getPlaceholderById(e){return this.placeholders.find(t=>t.content==e)}get placeholders(){return[...document.querySelectorAll("meta[name=turbo-permanent-placeholder][content]")]}}function ki(r){const e=document.createElement("meta");return e.setAttribute("name","turbo-permanent-placeholder"),e.setAttribute("content",r.id),e}var D;class At{constructor(e,t,s,n,i=!0){p(this,D,null);this.currentSnapshot=e,this.newSnapshot=t,this.isPreview=n,this.willRender=i,this.renderElement=s,this.promise=new Promise((o,a)=>this.resolvingFunctions={resolve:o,reject:a})}get shouldRender(){return!0}get reloadReason(){}prepareToRender(){}render(){}finishRendering(){this.resolvingFunctions&&(this.resolvingFunctions.resolve(),delete this.resolvingFunctions)}async preservingPermanentElements(e){await tr.preservingPermanentElements(this,this.permanentElementMap,e)}focusFirstAutofocusableElement(){const e=this.connectedSnapshot.firstAutofocusableElement;e&&e.focus()}enteringBardo(e){g(this,D)||e.contains(this.currentSnapshot.activeElement)&&C(this,D,this.currentSnapshot.activeElement)}leavingBardo(e){e.contains(g(this,D))&&g(this,D)instanceof HTMLElement&&(g(this,D).focus(),C(this,D,null))}get connectedSnapshot(){return this.newSnapshot.isConnected?this.newSnapshot:this.currentSnapshot}get currentElement(){return this.currentSnapshot.element}get newElement(){return this.newSnapshot.element}get permanentElementMap(){return this.currentSnapshot.getPermanentElementMapForSnapshot(this.newSnapshot)}get renderMethod(){return"replace"}}D=new WeakMap;class Bt extends At{static renderElement(e,t){var o;const s=document.createRange();s.selectNodeContents(e),s.deleteContents();const n=t,i=(o=n.ownerDocument)==null?void 0:o.createRange();i&&(i.selectNodeContents(n),e.appendChild(i.extractContents()))}constructor(e,t,s,n,i,o=!0){super(t,s,n,i,o),this.delegate=e}get shouldRender(){return!0}async render(){await oe(),this.preservingPermanentElements(()=>{this.loadFrameElement()}),this.scrollFrameIntoView(),await oe(),this.focusFirstAutofocusableElement(),await oe(),this.activateScriptElements()}loadFrameElement(){this.delegate.willRenderFrame(this.currentElement,this.newElement),this.renderElement(this.currentElement,this.newElement)}scrollFrameIntoView(){if(this.currentElement.autoscroll||this.newElement.autoscroll){const e=this.currentElement.firstElementChild,t=Ri(this.currentElement.getAttribute("data-autoscroll-block"),"end"),s=Mi(this.currentElement.getAttribute("data-autoscroll-behavior"),"auto");if(e)return e.scrollIntoView({block:t,behavior:s}),!0}return!1}activateScriptElements(){for(const e of this.newScriptElements){const t=we(e);e.replaceWith(t)}}get newScriptElements(){return this.currentElement.querySelectorAll("script")}}function Ri(r,e){return r=="end"||r=="start"||r=="center"||r=="nearest"?r:e}function Mi(r,e){return r=="auto"||r=="smooth"?r:e}const F=class F{constructor(){h(this,"hiding",!1);h(this,"value",0);h(this,"visible",!1);h(this,"trickle",()=>{this.setValue(this.value+Math.random()/100)});this.stylesheetElement=this.createStylesheetElement(),this.progressElement=this.createProgressElement(),this.installStylesheetElement(),this.setValue(0)}static get defaultCSS(){return Vs`
      .turbo-progress-bar {
        position: fixed;
        display: block;
        top: 0;
        left: 0;
        height: 3px;
        background: #0076ff;
        z-index: 2147483647;
        transition:
          width ${F.animationDuration}ms ease-out,
          opacity ${F.animationDuration/2}ms ${F.animationDuration/2}ms ease-in;
        transform: translate3d(0, 0, 0);
      }
    `}show(){this.visible||(this.visible=!0,this.installProgressElement(),this.startTrickling())}hide(){this.visible&&!this.hiding&&(this.hiding=!0,this.fadeProgressElement(()=>{this.uninstallProgressElement(),this.stopTrickling(),this.visible=!1,this.hiding=!1}))}setValue(e){this.value=e,this.refresh()}installStylesheetElement(){document.head.insertBefore(this.stylesheetElement,document.head.firstChild)}installProgressElement(){this.progressElement.style.width="0",this.progressElement.style.opacity="1",document.documentElement.insertBefore(this.progressElement,document.body),this.refresh()}fadeProgressElement(e){this.progressElement.style.opacity="0",setTimeout(e,F.animationDuration*1.5)}uninstallProgressElement(){this.progressElement.parentNode&&document.documentElement.removeChild(this.progressElement)}startTrickling(){this.trickleInterval||(this.trickleInterval=window.setInterval(this.trickle,F.animationDuration))}stopTrickling(){window.clearInterval(this.trickleInterval),delete this.trickleInterval}refresh(){requestAnimationFrame(()=>{this.progressElement.style.width=`${10+this.value*90}%`})}createStylesheetElement(){const e=document.createElement("style");return e.type="text/css",e.textContent=F.defaultCSS,this.cspNonce&&(e.nonce=this.cspNonce),e}createProgressElement(){const e=document.createElement("div");return e.className="turbo-progress-bar",e}get cspNonce(){return Ye("csp-nonce")}};h(F,"animationDuration",300);let Nt=F;class Ii extends Tt{constructor(){super(...arguments);h(this,"detailsByOuterHTML",this.children.filter(t=>!Fi(t)).map(t=>Ni(t)).reduce((t,s)=>{const{outerHTML:n}=s,i=n in t?t[n]:{type:Pi(s),tracked:Li(s),elements:[]};return{...t,[n]:{...i,elements:[...i.elements,s]}}},{}))}get trackedElementSignature(){return Object.keys(this.detailsByOuterHTML).filter(t=>this.detailsByOuterHTML[t].tracked).join("")}getScriptElementsNotInSnapshot(t){return this.getElementsMatchingTypeNotInSnapshot("script",t)}getStylesheetElementsNotInSnapshot(t){return this.getElementsMatchingTypeNotInSnapshot("stylesheet",t)}getElementsMatchingTypeNotInSnapshot(t,s){return Object.keys(this.detailsByOuterHTML).filter(n=>!(n in s.detailsByOuterHTML)).map(n=>this.detailsByOuterHTML[n]).filter(({type:n})=>n==t).map(({elements:[n]})=>n)}get provisionalElements(){return Object.keys(this.detailsByOuterHTML).reduce((t,s)=>{const{type:n,tracked:i,elements:o}=this.detailsByOuterHTML[s];return n==null&&!i?[...t,...o]:o.length>1?[...t,...o.slice(1)]:t},[])}getMetaValue(t){const s=this.findMetaElementByName(t);return s?s.getAttribute("content"):null}findMetaElementByName(t){return Object.keys(this.detailsByOuterHTML).reduce((s,n)=>{const{elements:[i]}=this.detailsByOuterHTML[n];return Bi(i,t)?i:s},void 0|void 0)}}function Pi(r){if(Oi(r))return"script";if(Di(r))return"stylesheet"}function Li(r){return r.getAttribute("data-turbo-track")=="reload"}function Oi(r){return r.localName=="script"}function Fi(r){return r.localName=="noscript"}function Di(r){const e=r.localName;return e=="style"||e=="link"&&r.getAttribute("rel")=="stylesheet"}function Bi(r,e){return r.localName=="meta"&&r.getAttribute("name")==e}function Ni(r){return r.hasAttribute("nonce")&&r.setAttribute("nonce",""),r}class I extends Tt{static fromHTMLString(e=""){return this.fromDocument(qs(e))}static fromElement(e){return this.fromDocument(e.ownerDocument)}static fromDocument({documentElement:e,body:t,head:s}){return new this(e,t,new Ii(s))}constructor(e,t,s){super(t),this.documentElement=e,this.headSnapshot=s}clone(){const e=this.element.cloneNode(!0),t=this.element.querySelectorAll("select"),s=e.querySelectorAll("select");for(const[n,i]of t.entries()){const o=s[n];for(const a of o.selectedOptions)a.selected=!1;for(const a of i.selectedOptions)o.options[a.index].selected=!0}for(const n of e.querySelectorAll('input[type="password"]'))n.value="";return new I(this.documentElement,e,this.headSnapshot)}get lang(){return this.documentElement.getAttribute("lang")}get headElement(){return this.headSnapshot.element}get rootLocation(){const e=this.getSetting("root")??"/";return T(e)}get cacheControlValue(){return this.getSetting("cache-control")}get isPreviewable(){return this.cacheControlValue!="no-preview"}get isCacheable(){return this.cacheControlValue!="no-cache"}get isVisitable(){return this.getSetting("visit-control")!="reload"}get prefersViewTransitions(){return this.headSnapshot.getMetaValue("view-transition")==="same-origin"}get shouldMorphPage(){return this.getSetting("refresh-method")==="morph"}get shouldPreserveScrollPosition(){return this.getSetting("refresh-scroll")==="preserve"}getSetting(e){return this.headSnapshot.getMetaValue(`turbo-${e}`)}}var ke,H;class $i{constructor(){p(this,ke,!1);p(this,H,Promise.resolve())}renderChange(e,t){return e&&this.viewTransitionsAvailable&&!g(this,ke)?(C(this,ke,!0),C(this,H,g(this,H).then(async()=>{await document.startViewTransition(t).finished}))):C(this,H,g(this,H).then(t)),g(this,H)}get viewTransitionsAvailable(){return document.startViewTransition}}ke=new WeakMap,H=new WeakMap;const Hi={action:"advance",historyChanged:!1,visitCachedSnapshot:()=>{},willRender:!0,updateHistory:!0,shouldCacheSnapshot:!0,acceptsStreamResponse:!1},$e={visitStart:"visitStart",requestStart:"requestStart",requestEnd:"requestEnd",visitEnd:"visitEnd"},O={initialized:"initialized",started:"started",canceled:"canceled",failed:"failed",completed:"completed"},ae={networkFailure:0,timeoutFailure:-1,contentTypeMismatch:-2};class xi{constructor(e,t,s,n={}){h(this,"identifier",W());h(this,"timingMetrics",{});h(this,"followedRedirect",!1);h(this,"historyChanged",!1);h(this,"scrolled",!1);h(this,"shouldCacheSnapshot",!0);h(this,"acceptsStreamResponse",!1);h(this,"snapshotCached",!1);h(this,"state",O.initialized);h(this,"viewTransitioner",new $i);this.delegate=e,this.location=t,this.restorationIdentifier=s||W();const{action:i,historyChanged:o,referrer:a,snapshot:l,snapshotHTML:u,response:d,visitCachedSnapshot:b,willRender:k,updateHistory:be,shouldCacheSnapshot:Rt,acceptsStreamResponse:kr}={...Hi,...n};this.action=i,this.historyChanged=o,this.referrer=a,this.snapshot=l,this.snapshotHTML=u,this.response=d,this.isSamePage=this.delegate.locationWithActionIsSamePage(this.location,this.action),this.visitCachedSnapshot=b,this.willRender=k,this.updateHistory=be,this.scrolled=!k,this.shouldCacheSnapshot=Rt,this.acceptsStreamResponse=kr}get adapter(){return this.delegate.adapter}get view(){return this.delegate.view}get history(){return this.delegate.history}get restorationData(){return this.history.getRestorationDataForIdentifier(this.restorationIdentifier)}get silent(){return this.isSamePage}start(){this.state==O.initialized&&(this.recordTimingMetric($e.visitStart),this.state=O.started,this.adapter.visitStarted(this),this.delegate.visitStarted(this))}cancel(){this.state==O.started&&(this.request&&this.request.cancel(),this.cancelRender(),this.state=O.canceled)}complete(){this.state==O.started&&(this.recordTimingMetric($e.visitEnd),this.state=O.completed,this.followRedirect(),this.followedRedirect||(this.adapter.visitCompleted(this),this.delegate.visitCompleted(this)))}fail(){this.state==O.started&&(this.state=O.failed,this.adapter.visitFailed(this),this.delegate.visitCompleted(this))}changeHistory(){var e;if(!this.historyChanged&&this.updateHistory){const t=this.location.href===((e=this.referrer)==null?void 0:e.href)?"replace":this.action,s=Ws(t);this.history.update(s,this.location,this.restorationIdentifier),this.historyChanged=!0}}issueRequest(){this.hasPreloadedResponse()?this.simulateRequest():this.shouldIssueRequest()&&!this.request&&(this.request=new Gt(this,L.get,this.location),this.request.perform())}simulateRequest(){this.response&&(this.startRequest(),this.recordResponse(),this.finishRequest())}startRequest(){this.recordTimingMetric($e.requestStart),this.adapter.visitRequestStarted(this)}recordResponse(e=this.response){if(this.response=e,e){const{statusCode:t}=e;gs(t)?this.adapter.visitRequestCompleted(this):this.adapter.visitRequestFailedWithStatusCode(this,t)}}finishRequest(){this.recordTimingMetric($e.requestEnd),this.adapter.visitRequestFinished(this)}loadResponse(){if(this.response){const{statusCode:e,responseHTML:t}=this.response;this.render(async()=>{if(this.shouldCacheSnapshot&&this.cacheSnapshot(),this.view.renderPromise&&await this.view.renderPromise,gs(e)&&t!=null){const s=I.fromHTMLString(t);await this.renderPageSnapshot(s,!1),this.adapter.visitRendered(this),this.complete()}else await this.view.renderError(I.fromHTMLString(t),this),this.adapter.visitRendered(this),this.fail()})}}getCachedSnapshot(){const e=this.view.getCachedSnapshotForLocation(this.location)||this.getPreloadedSnapshot();if(e&&(!Y(this.location)||e.hasAnchor(Y(this.location)))&&(this.action=="restore"||e.isPreviewable))return e}getPreloadedSnapshot(){if(this.snapshotHTML)return I.fromHTMLString(this.snapshotHTML)}hasCachedSnapshot(){return this.getCachedSnapshot()!=null}loadCachedSnapshot(){const e=this.getCachedSnapshot();if(e){const t=this.shouldIssueRequest();this.render(async()=>{this.cacheSnapshot(),this.isSamePage?this.adapter.visitRendered(this):(this.view.renderPromise&&await this.view.renderPromise,await this.renderPageSnapshot(e,t),this.adapter.visitRendered(this),t||this.complete())})}}followRedirect(){var e;this.redirectedToLocation&&!this.followedRedirect&&((e=this.response)!=null&&e.redirected)&&(this.adapter.visitProposedToLocation(this.redirectedToLocation,{action:"replace",response:this.response,shouldCacheSnapshot:!1,willRender:!1}),this.followedRedirect=!0)}goToSamePageAnchor(){this.isSamePage&&this.render(async()=>{this.cacheSnapshot(),this.performScroll(),this.changeHistory(),this.adapter.visitRendered(this)})}prepareRequest(e){this.acceptsStreamResponse&&e.acceptResponseType(te.contentType)}requestStarted(){this.startRequest()}requestPreventedHandlingResponse(e,t){}async requestSucceededWithResponse(e,t){const s=await t.responseHTML,{redirected:n,statusCode:i}=t;s==null?this.recordResponse({statusCode:ae.contentTypeMismatch,redirected:n}):(this.redirectedToLocation=t.redirected?t.location:void 0,this.recordResponse({statusCode:i,responseHTML:s,redirected:n}))}async requestFailedWithResponse(e,t){const s=await t.responseHTML,{redirected:n,statusCode:i}=t;s==null?this.recordResponse({statusCode:ae.contentTypeMismatch,redirected:n}):this.recordResponse({statusCode:i,responseHTML:s,redirected:n})}requestErrored(e,t){this.recordResponse({statusCode:ae.networkFailure,redirected:!1})}requestFinished(){this.finishRequest()}performScroll(){!this.scrolled&&!this.view.forceReloaded&&!this.view.snapshot.shouldPreserveScrollPosition&&(this.action=="restore"?this.scrollToRestoredPosition()||this.scrollToAnchor()||this.view.scrollToTop():this.scrollToAnchor()||this.view.scrollToTop(),this.isSamePage&&this.delegate.visitScrolledToSamePageLocation(this.view.lastRenderedLocation,this.location),this.scrolled=!0)}scrollToRestoredPosition(){const{scrollPosition:e}=this.restorationData;if(e)return this.view.scrollToPosition(e),!0}scrollToAnchor(){const e=Y(this.location);if(e!=null)return this.view.scrollToAnchor(e),!0}recordTimingMetric(e){this.timingMetrics[e]=new Date().getTime()}getTimingMetrics(){return{...this.timingMetrics}}getHistoryMethodForAction(e){switch(e){case"replace":return history.replaceState;case"advance":case"restore":return history.pushState}}hasPreloadedResponse(){return typeof this.response=="object"}shouldIssueRequest(){return this.isSamePage?!1:this.action=="restore"?!this.hasCachedSnapshot():this.willRender}cacheSnapshot(){this.snapshotCached||(this.view.cacheSnapshot(this.snapshot).then(e=>e&&this.visitCachedSnapshot(e)),this.snapshotCached=!0)}async render(e){this.cancelRender(),await new Promise(t=>{this.frame=requestAnimationFrame(()=>t())}),await e(),delete this.frame}async renderPageSnapshot(e,t){await this.viewTransitioner.renderChange(this.view.shouldTransitionTo(e),async()=>{await this.view.renderPage(e,t,this.willRender,this),this.performScroll()})}cancelRender(){this.frame&&(cancelAnimationFrame(this.frame),delete this.frame)}}function gs(r){return r>=200&&r<300}class qi{constructor(e){h(this,"progressBar",new Nt);h(this,"showProgressBar",()=>{this.progressBar.show()});this.session=e}visitProposedToLocation(e,t){ie(e,this.navigator.rootLocation)?this.navigator.startVisit(e,(t==null?void 0:t.restorationIdentifier)||W(),t):window.location.href=e.toString()}visitStarted(e){this.location=e.location,e.loadCachedSnapshot(),e.issueRequest(),e.goToSamePageAnchor()}visitRequestStarted(e){this.progressBar.setValue(0),e.hasCachedSnapshot()||e.action!="restore"?this.showVisitProgressBarAfterDelay():this.showProgressBar()}visitRequestCompleted(e){e.loadResponse()}visitRequestFailedWithStatusCode(e,t){switch(t){case ae.networkFailure:case ae.timeoutFailure:case ae.contentTypeMismatch:return this.reload({reason:"request_failed",context:{statusCode:t}});default:return e.loadResponse()}}visitRequestFinished(e){}visitCompleted(e){this.progressBar.setValue(1),this.hideVisitProgressBar()}pageInvalidated(e){this.reload(e)}visitFailed(e){this.progressBar.setValue(1),this.hideVisitProgressBar()}visitRendered(e){}formSubmissionStarted(e){this.progressBar.setValue(0),this.showFormProgressBarAfterDelay()}formSubmissionFinished(e){this.progressBar.setValue(1),this.hideFormProgressBar()}showVisitProgressBarAfterDelay(){this.visitProgressBarTimeout=window.setTimeout(this.showProgressBar,this.session.progressBarDelay)}hideVisitProgressBar(){this.progressBar.hide(),this.visitProgressBarTimeout!=null&&(window.clearTimeout(this.visitProgressBarTimeout),delete this.visitProgressBarTimeout)}showFormProgressBarAfterDelay(){this.formProgressBarTimeout==null&&(this.formProgressBarTimeout=window.setTimeout(this.showProgressBar,this.session.progressBarDelay))}hideFormProgressBar(){this.progressBar.hide(),this.formProgressBarTimeout!=null&&(window.clearTimeout(this.formProgressBarTimeout),delete this.formProgressBarTimeout)}reload(e){var t;E("turbo:reload",{detail:e}),window.location.href=((t=this.location)==null?void 0:t.toString())||window.location.href}get navigator(){return this.session.navigator}}class Vi{constructor(){h(this,"selector","[data-turbo-temporary]");h(this,"deprecatedSelector","[data-turbo-cache=false]");h(this,"started",!1);h(this,"removeTemporaryElements",e=>{for(const t of this.temporaryElements)t.remove()})}start(){this.started||(this.started=!0,addEventListener("turbo:before-cache",this.removeTemporaryElements,!1))}stop(){this.started&&(this.started=!1,removeEventListener("turbo:before-cache",this.removeTemporaryElements,!1))}get temporaryElements(){return[...document.querySelectorAll(this.selector),...this.temporaryElementsWithDeprecation]}get temporaryElementsWithDeprecation(){const e=document.querySelectorAll(this.deprecatedSelector);return e.length&&console.warn(`The ${this.deprecatedSelector} selector is deprecated and will be removed in a future version. Use ${this.selector} instead.`),[...e]}}var nt,sr,ce,Ve,le,We;class Wi{constructor(e,t){p(this,nt);p(this,ce);p(this,le);this.session=e,this.element=t,this.linkInterceptor=new Qs(this,t),this.formSubmitObserver=new Qt(this,t)}start(){this.linkInterceptor.start(),this.formSubmitObserver.start()}stop(){this.linkInterceptor.stop(),this.formSubmitObserver.stop()}shouldInterceptLinkClick(e,t,s){return f(this,ce,Ve).call(this,e)}linkClickIntercepted(e,t,s){const n=f(this,le,We).call(this,e);n&&n.delegate.linkClickIntercepted(e,t,s)}willSubmitForm(e,t){return e.closest("turbo-frame")==null&&f(this,nt,sr).call(this,e,t)&&f(this,ce,Ve).call(this,e,t)}formSubmitted(e,t){const s=f(this,le,We).call(this,e,t);s&&s.delegate.formSubmitted(e,t)}}nt=new WeakSet,sr=function(e,t){const s=Ut(e,t),n=this.element.ownerDocument.querySelector('meta[name="turbo-root"]'),i=T((n==null?void 0:n.content)??"/");return f(this,ce,Ve).call(this,e,t)&&ie(s,i)},ce=new WeakSet,Ve=function(e,t){if(e instanceof HTMLFormElement?this.session.submissionIsNavigatable(e,t):this.session.elementIsNavigatable(e)){const n=f(this,le,We).call(this,e,t);return n?n!=e.closest("turbo-frame"):!1}else return!1},le=new WeakSet,We=function(e,t){const s=(t==null?void 0:t.getAttribute("data-turbo-frame"))||e.getAttribute("data-turbo-frame");if(s&&s!="_top"){const n=this.element.querySelector(`#${s}:not([disabled])`);if(n instanceof N)return n}};class ji{constructor(e){h(this,"location");h(this,"restorationIdentifier",W());h(this,"restorationData",{});h(this,"started",!1);h(this,"pageLoaded",!1);h(this,"onPopState",e=>{if(this.shouldHandlePopState()){const{turbo:t}=e.state||{};if(t){this.location=new URL(window.location.href);const{restorationIdentifier:s}=t;this.restorationIdentifier=s,this.delegate.historyPoppedToLocationWithRestorationIdentifier(this.location,s)}}});h(this,"onPageLoad",async e=>{await ii(),this.pageLoaded=!0});this.delegate=e}start(){this.started||(addEventListener("popstate",this.onPopState,!1),addEventListener("load",this.onPageLoad,!1),this.started=!0,this.replace(new URL(window.location.href)))}stop(){this.started&&(removeEventListener("popstate",this.onPopState,!1),removeEventListener("load",this.onPageLoad,!1),this.started=!1)}push(e,t){this.update(history.pushState,e,t)}replace(e,t){this.update(history.replaceState,e,t)}update(e,t,s=W()){const n={turbo:{restorationIdentifier:s}};e.call(history,n,"",t.href),this.location=t,this.restorationIdentifier=s}getRestorationDataForIdentifier(e){return this.restorationData[e]||{}}updateRestorationData(e){const{restorationIdentifier:t}=this,s=this.restorationData[t];this.restorationData[t]={...s,...e}}assumeControlOfScrollRestoration(){this.previousScrollRestoration||(this.previousScrollRestoration=history.scrollRestoration??"auto",history.scrollRestoration="manual")}relinquishControlOfScrollRestoration(){this.previousScrollRestoration&&(history.scrollRestoration=this.previousScrollRestoration,delete this.previousScrollRestoration)}shouldHandlePopState(){return this.pageIsLoaded()}pageIsLoaded(){return this.pageLoaded||document.readyState=="complete"}}var it,rr,ot,nr;class Ui{constructor(e){p(this,it);p(this,ot);this.delegate=e}proposeVisit(e,t={}){this.delegate.allowsVisitingLocationWithAction(e,t.action)&&this.delegate.visitProposedToLocation(e,t)}startVisit(e,t,s={}){this.stop(),this.currentVisit=new xi(this,T(e),t,{referrer:this.location,...s}),this.currentVisit.start()}submitForm(e,t){this.stop(),this.formSubmission=new De(this,e,t,!0),this.formSubmission.start()}stop(){this.formSubmission&&(this.formSubmission.stop(),delete this.formSubmission),this.currentVisit&&(this.currentVisit.cancel(),delete this.currentVisit)}get adapter(){return this.delegate.adapter}get view(){return this.delegate.view}get rootLocation(){return this.view.snapshot.rootLocation}get history(){return this.delegate.history}formSubmissionStarted(e){typeof this.adapter.formSubmissionStarted=="function"&&this.adapter.formSubmissionStarted(e)}async formSubmissionSucceededWithResponse(e,t){if(e==this.formSubmission){const s=await t.responseHTML;if(s){const n=e.isSafe;n||this.view.clearSnapshotCache();const{statusCode:i,redirected:o}=t,l={action:f(this,it,rr).call(this,e,t),shouldCacheSnapshot:n,response:{statusCode:i,responseHTML:s,redirected:o}};this.proposeVisit(t.location,l)}}}async formSubmissionFailedWithResponse(e,t){const s=await t.responseHTML;if(s){const n=I.fromHTMLString(s);t.serverError?await this.view.renderError(n,this.currentVisit):await this.view.renderPage(n,!1,!0,this.currentVisit),n.shouldPreserveScrollPosition||this.view.scrollToTop(),this.view.clearSnapshotCache()}}formSubmissionErrored(e,t){console.error(t)}formSubmissionFinished(e){typeof this.adapter.formSubmissionFinished=="function"&&this.adapter.formSubmissionFinished(e)}visitStarted(e){this.delegate.visitStarted(e)}visitCompleted(e){this.delegate.visitCompleted(e)}locationWithActionIsSamePage(e,t){const s=Y(e),n=Y(this.view.lastRenderedLocation),i=t==="restore"&&typeof s>"u";return t!=="replace"&&Ot(e)===Ot(this.view.lastRenderedLocation)&&(i||s!=null&&s!==n)}visitScrolledToSamePageLocation(e,t){this.delegate.visitScrolledToSamePageLocation(e,t)}get location(){return this.history.location}get restorationIdentifier(){return this.history.restorationIdentifier}}it=new WeakSet,rr=function(e,t){const{submitter:s,formElement:n}=e;return Ct(s,n)||f(this,ot,nr).call(this,t)},ot=new WeakSet,nr=function(e){var s;return e.redirected&&e.location.href===((s=this.location)==null?void 0:s.href)?"replace":"advance"};const U={initial:0,loading:1,interactive:2,complete:3};class Ki{constructor(e){h(this,"stage",U.initial);h(this,"started",!1);h(this,"interpretReadyState",()=>{const{readyState:e}=this;e=="interactive"?this.pageIsInteractive():e=="complete"&&this.pageIsComplete()});h(this,"pageWillUnload",()=>{this.delegate.pageWillUnload()});this.delegate=e}start(){this.started||(this.stage==U.initial&&(this.stage=U.loading),document.addEventListener("readystatechange",this.interpretReadyState,!1),addEventListener("pagehide",this.pageWillUnload,!1),this.started=!0)}stop(){this.started&&(document.removeEventListener("readystatechange",this.interpretReadyState,!1),removeEventListener("pagehide",this.pageWillUnload,!1),this.started=!1)}pageIsInteractive(){this.stage==U.loading&&(this.stage=U.interactive,this.delegate.pageBecameInteractive())}pageIsComplete(){this.pageIsInteractive(),this.stage==U.interactive&&(this.stage=U.complete,this.delegate.pageLoaded())}get readyState(){return document.readyState}}class zi{constructor(e){h(this,"started",!1);h(this,"onScroll",()=>{this.updatePosition({x:window.pageXOffset,y:window.pageYOffset})});this.delegate=e}start(){this.started||(addEventListener("scroll",this.onScroll,!1),this.onScroll(),this.started=!0)}stop(){this.started&&(removeEventListener("scroll",this.onScroll,!1),this.started=!1)}updatePosition(e){this.delegate.scrollPositionChanged(e)}}class Ji{render({fragment:e}){tr.preservingPermanentElements(this,Xi(e),()=>{Gi(e,()=>{Yi(()=>{document.documentElement.appendChild(e)})})})}enteringBardo(e,t){t.replaceWith(e.cloneNode(!0))}leavingBardo(){}}function Xi(r){const e=Gs(document.documentElement),t={};for(const s of e){const{id:n}=s;for(const i of r.querySelectorAll("turbo-stream")){const o=Xs(i.templateElement.content,n);o&&(t[n]=[s,o])}}return t}async function Gi(r,e){const t=`turbo-stream-autofocus-${W()}`,s=r.querySelectorAll("turbo-stream"),n=Qi(s);let i=null;if(n&&(n.id?i=n.id:i=t,n.id=i),e(),await oe(),(document.activeElement==null||document.activeElement==document.body)&&i){const a=document.getElementById(i);zt(a)&&a.focus(),a&&a.id==t&&a.removeAttribute("id")}}async function Yi(r){const[e,t]=await ui(r,()=>document.activeElement),s=e&&e.id;if(s){const n=document.getElementById(s);zt(n)&&n!=t&&n.focus()}}function Qi(r){for(const e of r){const t=Us(e.templateElement.content);if(t)return t}return null}var x;class Zi{constructor(e){h(this,"sources",new Set);p(this,x,!1);h(this,"inspectFetchResponse",e=>{const t=eo(e);t&&to(t)&&(e.preventDefault(),this.receiveMessageResponse(t))});h(this,"receiveMessageEvent",e=>{g(this,x)&&typeof e.data=="string"&&this.receiveMessageHTML(e.data)});this.delegate=e}start(){g(this,x)||(C(this,x,!0),addEventListener("turbo:before-fetch-response",this.inspectFetchResponse,!1))}stop(){g(this,x)&&(C(this,x,!1),removeEventListener("turbo:before-fetch-response",this.inspectFetchResponse,!1))}connectStreamSource(e){this.streamSourceIsConnected(e)||(this.sources.add(e),e.addEventListener("message",this.receiveMessageEvent,!1))}disconnectStreamSource(e){this.streamSourceIsConnected(e)&&(this.sources.delete(e),e.removeEventListener("message",this.receiveMessageEvent,!1))}streamSourceIsConnected(e){return this.sources.has(e)}async receiveMessageResponse(e){const t=await e.responseHTML;t&&this.receiveMessageHTML(t)}receiveMessageHTML(e){this.delegate.receivedMessageFromStream(te.wrap(e))}}x=new WeakMap;function eo(r){var t;const e=(t=r.detail)==null?void 0:t.fetchResponse;if(e instanceof Kt)return e}function to(r){return(r.contentType??"").startsWith(te.contentType)}class bs extends At{static renderElement(e,t){const{documentElement:s,body:n}=document;s.replaceChild(t,n)}async render(){this.replaceHeadAndBody(),this.activateScriptElements()}replaceHeadAndBody(){const{documentElement:e,head:t}=document;e.replaceChild(this.newHead,t),this.renderElement(this.currentElement,this.newElement)}activateScriptElements(){for(const e of this.scriptElements){const t=e.parentNode;if(t){const s=we(e);t.replaceChild(s,e)}}}get newHead(){return this.newSnapshot.headSnapshot.element}get scriptElements(){return document.documentElement.querySelectorAll("script")}}let Zt=new Set;function so(r,e,t={}){r instanceof Document&&(r=r.documentElement),typeof e=="string"&&(e=ao(e));let s=co(e),n=no(r,s,t);return ir(r,s,n)}function ir(r,e,t){if(t.head.block){let s=r.querySelector("head"),n=e.querySelector("head");if(s&&n){let i=ar(n,s,t);Promise.all(i).then(function(){ir(r,e,Object.assign(t,{head:{block:!1,ignore:!0}}))});return}}if(t.morphStyle==="innerHTML")return or(e,r,t),r.children;if(t.morphStyle==="outerHTML"||t.morphStyle==null){let s=ho(e,r,t),n=s==null?void 0:s.previousSibling,i=s==null?void 0:s.nextSibling,o=je(r,s,t);return s?lo(n,o,i):[]}else throw"Do not understand how to morph style "+t.morphStyle}function je(r,e,t){if(!(t.ignoreActive&&r===document.activeElement))return e==null?t.callbacks.beforeNodeRemoved(r)===!1?void 0:(r.remove(),t.callbacks.afterNodeRemoved(r),null):Ze(r,e)?t.callbacks.beforeNodeMorphed(r,e)===!1?void 0:(r instanceof HTMLHeadElement&&t.head.ignore||(r instanceof HTMLHeadElement&&t.head.style!=="morph"?ar(e,r,t):(ro(e,r),or(e,r,t))),t.callbacks.afterNodeMorphed(r,e),r):t.callbacks.beforeNodeRemoved(r)===!1||t.callbacks.beforeNodeAdded(e)===!1?void 0:(r.parentElement.replaceChild(e,r),t.callbacks.afterNodeAdded(e),t.callbacks.afterNodeRemoved(r),e)}function or(r,e,t){let s=r.firstChild,n=e.firstChild,i;for(;s;){if(i=s,s=i.nextSibling,n==null){if(t.callbacks.beforeNodeAdded(i)===!1)return;e.appendChild(i),t.callbacks.afterNodeAdded(i),J(t,i);continue}if(cr(i,n,t)){je(n,i,t),n=n.nextSibling,J(t,i);continue}let o=io(r,e,i,n,t);if(o){n=vs(n,o,t),je(o,i,t),J(t,i);continue}let a=oo(r,e,i,n,t);if(a){n=vs(n,a,t),je(a,i,t),J(t,i);continue}if(t.callbacks.beforeNodeAdded(i)===!1)return;e.insertBefore(i,n),t.callbacks.afterNodeAdded(i),J(t,i)}for(;n!==null;){let o=n;n=n.nextSibling,lr(o,t)}}function ro(r,e){let t=r.nodeType;if(t===1){const s=r.attributes,n=e.attributes;for(const i of s)e.getAttribute(i.name)!==i.value&&e.setAttribute(i.name,i.value);for(const i of n)r.hasAttribute(i.name)||e.removeAttribute(i.name)}if((t===8||t===3)&&e.nodeValue!==r.nodeValue&&(e.nodeValue=r.nodeValue),r instanceof HTMLInputElement&&e instanceof HTMLInputElement&&r.type!=="file")e.value=r.value||"",He(r,e,"value"),He(r,e,"checked"),He(r,e,"disabled");else if(r instanceof HTMLOptionElement)He(r,e,"selected");else if(r instanceof HTMLTextAreaElement&&e instanceof HTMLTextAreaElement){let s=r.value,n=e.value;s!==n&&(e.value=s),e.firstChild&&e.firstChild.nodeValue!==s&&(e.firstChild.nodeValue=s)}}function He(r,e,t){r[t]!==e[t]&&(r[t]?e.setAttribute(t,r[t]):e.removeAttribute(t))}function ar(r,e,t){let s=[],n=[],i=[],o=[],a=t.head.style,l=new Map;for(const d of r.children)l.set(d.outerHTML,d);for(const d of e.children){let b=l.has(d.outerHTML),k=t.head.shouldReAppend(d),be=t.head.shouldPreserve(d);b||be?k?n.push(d):(l.delete(d.outerHTML),i.push(d)):a==="append"?k&&(n.push(d),o.push(d)):t.head.shouldRemove(d)!==!1&&n.push(d)}o.push(...l.values());let u=[];for(const d of o){let b=document.createRange().createContextualFragment(d.outerHTML).firstChild;if(t.callbacks.beforeNodeAdded(b)!==!1){if(b.href||b.src){let k=null,be=new Promise(function(Rt){k=Rt});b.addEventListener("load",function(){k()}),u.push(be)}e.appendChild(b),t.callbacks.afterNodeAdded(b),s.push(b)}}for(const d of n)t.callbacks.beforeNodeRemoved(d)!==!1&&(e.removeChild(d),t.callbacks.afterNodeRemoved(d));return t.head.afterHeadMorphed(e,{added:s,kept:i,removed:n}),u}function $(){}function no(r,e,t){return{target:r,newContent:e,config:t,morphStyle:t.morphStyle,ignoreActive:t.ignoreActive,idMap:mo(r,e),deadIds:new Set,callbacks:Object.assign({beforeNodeAdded:$,afterNodeAdded:$,beforeNodeMorphed:$,afterNodeMorphed:$,beforeNodeRemoved:$,afterNodeRemoved:$},t.callbacks),head:Object.assign({style:"merge",shouldPreserve:function(s){return s.getAttribute("im-preserve")==="true"},shouldReAppend:function(s){return s.getAttribute("im-re-append")==="true"},shouldRemove:$,afterHeadMorphed:$},t.head)}}function cr(r,e,t){return r==null||e==null?!1:r.nodeType===e.nodeType&&r.tagName===e.tagName?r.id!==""&&r.id===e.id?!0:Se(t,r,e)>0:!1}function Ze(r,e){return r==null||e==null?!1:r.nodeType===e.nodeType&&r.tagName===e.tagName}function vs(r,e,t){for(;r!==e;){let s=r;r=r.nextSibling,lr(s,t)}return J(t,e),e.nextSibling}function io(r,e,t,s,n){let i=Se(n,t,e),o=null;if(i>0){let a=s,l=0;for(;a!=null;){if(cr(t,a,n))return a;if(l+=Se(n,a,r),l>i)return null;a=a.nextSibling}}return o}function oo(r,e,t,s,n){let i=s,o=t.nextSibling,a=0;for(;i!=null;){if(Se(n,i,r)>0)return null;if(Ze(t,i))return i;if(Ze(o,i)&&(a++,o=o.nextSibling,a>=2))return null;i=i.nextSibling}return i}function ao(r){let e=new DOMParser,t=r.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(t.match(/<\/html>/)||t.match(/<\/head>/)||t.match(/<\/body>/)){let s=e.parseFromString(r,"text/html");if(t.match(/<\/html>/))return s.generatedByIdiomorph=!0,s;{let n=s.firstChild;return n?(n.generatedByIdiomorph=!0,n):null}}else{let n=e.parseFromString("<body><template>"+r+"</template></body>","text/html").body.querySelector("template").content;return n.generatedByIdiomorph=!0,n}}function co(r){if(r==null)return document.createElement("div");if(r.generatedByIdiomorph)return r;if(r instanceof Node){const e=document.createElement("div");return e.append(r),e}else{const e=document.createElement("div");for(const t of[...r])e.append(t);return e}}function lo(r,e,t){let s=[],n=[];for(;r!=null;)s.push(r),r=r.previousSibling;for(;s.length>0;){let i=s.pop();n.push(i),e.parentElement.insertBefore(i,e)}for(n.push(e);t!=null;)s.push(t),n.push(t),t=t.nextSibling;for(;s.length>0;)e.parentElement.insertBefore(s.pop(),e.nextSibling);return n}function ho(r,e,t){let s;s=r.firstChild;let n=s,i=0;for(;s;){let o=uo(s,e,t);o>i&&(n=s,i=o),s=s.nextSibling}return n}function uo(r,e,t){return Ze(r,e)?.5+Se(t,r,e):0}function lr(r,e){J(e,r),e.callbacks.beforeNodeRemoved(r)!==!1&&(r.remove(),e.callbacks.afterNodeRemoved(r))}function fo(r,e){return!r.deadIds.has(e)}function po(r,e,t){return(r.idMap.get(t)||Zt).has(e)}function J(r,e){let t=r.idMap.get(e)||Zt;for(const s of t)r.deadIds.add(s)}function Se(r,e,t){let s=r.idMap.get(e)||Zt,n=0;for(const i of s)fo(r,i)&&po(r,i,t)&&++n;return n}function ys(r,e){let t=r.parentElement,s=r.querySelectorAll("[id]");for(const n of s){let i=n;for(;i!==t&&i!=null;){let o=e.get(i);o==null&&(o=new Set,e.set(i,o)),o.add(n.id),i=i.parentElement}}}function mo(r,e){let t=new Map;return ys(r,t),ys(e,t),t}var go={morph:so},at,hr,Re,$t,ct,Me,lt,ht,ur,ut,dr,dt,he,Ue,ft,fr;class bo extends At{constructor(){super(...arguments);p(this,at);p(this,Re);p(this,ht);p(this,ut);p(this,he);p(this,ft);p(this,ct,t=>!(t.id&&t.hasAttribute("data-turbo-permanent")&&document.getElementById(t.id)));p(this,Me,(t,s)=>t instanceof HTMLElement?!t.hasAttribute("data-turbo-permanent")&&(this.isMorphingTurboFrame||!f(this,he,Ue).call(this,t)):!0);p(this,lt,t=>g(this,Me).call(this,t));p(this,dt,(t,s)=>{E("turbo:before-frame-morph",{target:t,detail:{currentElement:t,newElement:s}}),f(this,Re,$t).call(this,t,s.children,"innerHTML")})}async render(){this.willRender&&await f(this,at,hr).call(this)}get renderMethod(){return"morph"}}at=new WeakSet,hr=async function(){f(this,Re,$t).call(this,this.currentElement,this.newElement),f(this,ht,ur).call(this),E("turbo:morph",{detail:{currentElement:this.currentElement,newElement:this.newElement}})},Re=new WeakSet,$t=function(t,s,n="outerHTML"){this.isMorphingTurboFrame=f(this,he,Ue).call(this,t),go.morph(t,s,{morphStyle:n,callbacks:{beforeNodeAdded:g(this,ct),beforeNodeMorphed:g(this,Me),beforeNodeRemoved:g(this,lt)}})},ct=new WeakMap,Me=new WeakMap,lt=new WeakMap,ht=new WeakSet,ur=function(){f(this,ft,fr).call(this).forEach(t=>{f(this,he,Ue).call(this,t)&&(f(this,ut,dr).call(this,t),t.reload())})},ut=new WeakSet,dr=function(t){t.addEventListener("turbo:before-frame-render",s=>{s.detail.render=g(this,dt)},{once:!0})},dt=new WeakMap,he=new WeakSet,Ue=function(t){return t.src&&t.refresh==="morph"},ft=new WeakSet,fr=function(){return Array.from(document.querySelectorAll("turbo-frame[src]")).filter(t=>!t.closest("[data-turbo-permanent]"))};var pt,pr;class Ht extends At{constructor(){super(...arguments);p(this,pt)}static renderElement(t,s){document.body&&s instanceof HTMLBodyElement?document.body.replaceWith(s):document.documentElement.appendChild(s)}get shouldRender(){return this.newSnapshot.isVisitable&&this.trackedElementsAreIdentical}get reloadReason(){if(!this.newSnapshot.isVisitable)return{reason:"turbo_visit_control_is_reload"};if(!this.trackedElementsAreIdentical)return{reason:"tracked_element_mismatch"}}async prepareToRender(){f(this,pt,pr).call(this),await this.mergeHead()}async render(){this.willRender&&await this.replaceBody()}finishRendering(){super.finishRendering(),this.isPreview||this.focusFirstAutofocusableElement()}get currentHeadSnapshot(){return this.currentSnapshot.headSnapshot}get newHeadSnapshot(){return this.newSnapshot.headSnapshot}get newElement(){return this.newSnapshot.element}async mergeHead(){const t=this.mergeProvisionalElements(),s=this.copyNewHeadStylesheetElements();this.copyNewHeadScriptElements(),await t,await s}async replaceBody(){await this.preservingPermanentElements(async()=>{this.activateNewBody(),await this.assignNewBody()})}get trackedElementsAreIdentical(){return this.currentHeadSnapshot.trackedElementSignature==this.newHeadSnapshot.trackedElementSignature}async copyNewHeadStylesheetElements(){const t=[];for(const s of this.newHeadStylesheetElements)t.push(ci(s)),document.head.appendChild(s);await Promise.all(t)}copyNewHeadScriptElements(){for(const t of this.newHeadScriptElements)document.head.appendChild(we(t))}async mergeProvisionalElements(){const t=[...this.newHeadProvisionalElements];for(const s of this.currentHeadProvisionalElements)this.isCurrentElementInElementList(s,t)||document.head.removeChild(s);for(const s of t)document.head.appendChild(s)}isCurrentElementInElementList(t,s){for(const[n,i]of s.entries()){if(t.tagName=="TITLE"){if(i.tagName!="TITLE")continue;if(t.innerHTML==i.innerHTML)return s.splice(n,1),!0}if(i.isEqualNode(t))return s.splice(n,1),!0}return!1}removeCurrentHeadProvisionalElements(){for(const t of this.currentHeadProvisionalElements)document.head.removeChild(t)}copyNewHeadProvisionalElements(){for(const t of this.newHeadProvisionalElements)document.head.appendChild(t)}activateNewBody(){document.adoptNode(this.newElement),this.activateNewBodyScriptElements()}activateNewBodyScriptElements(){for(const t of this.newBodyScriptElements){const s=we(t);t.replaceWith(s)}}async assignNewBody(){await this.renderElement(this.currentElement,this.newElement)}get newHeadStylesheetElements(){return this.newHeadSnapshot.getStylesheetElementsNotInSnapshot(this.currentHeadSnapshot)}get newHeadScriptElements(){return this.newHeadSnapshot.getScriptElementsNotInSnapshot(this.currentHeadSnapshot)}get currentHeadProvisionalElements(){return this.currentHeadSnapshot.provisionalElements}get newHeadProvisionalElements(){return this.newHeadSnapshot.provisionalElements}get newBodyScriptElements(){return this.newElement.querySelectorAll("script")}}pt=new WeakSet,pr=function(){const{documentElement:t}=this.currentSnapshot,{lang:s}=this.newSnapshot;s?t.setAttribute("lang",s):t.removeAttribute("lang")};class vo{constructor(e){h(this,"keys",[]);h(this,"snapshots",{});this.size=e}has(e){return Ne(e)in this.snapshots}get(e){if(this.has(e)){const t=this.read(e);return this.touch(e),t}}put(e,t){return this.write(e,t),this.touch(e),t}clear(){this.snapshots={}}read(e){return this.snapshots[Ne(e)]}write(e,t){this.snapshots[Ne(e)]=t}touch(e){const t=Ne(e),s=this.keys.indexOf(t);s>-1&&this.keys.splice(s,1),this.keys.unshift(t),this.trim()}trim(){for(const e of this.keys.splice(this.size))delete this.snapshots[e]}}class yo extends Ys{constructor(){super(...arguments);h(this,"snapshotCache",new vo(10));h(this,"lastRenderedLocation",new URL(location.href));h(this,"forceReloaded",!1)}shouldTransitionTo(t){return this.snapshot.prefersViewTransitions&&t.prefersViewTransitions}renderPage(t,s=!1,n=!0,i){const a=this.isPageRefresh(i)&&this.snapshot.shouldMorphPage?bo:Ht,l=new a(this.snapshot,t,Ht.renderElement,s,n);return l.shouldRender?i==null||i.changeHistory():this.forceReloaded=!0,this.render(l)}renderError(t,s){s==null||s.changeHistory();const n=new bs(this.snapshot,t,bs.renderElement,!1);return this.render(n)}clearSnapshotCache(){this.snapshotCache.clear()}async cacheSnapshot(t=this.snapshot){if(t.isCacheable){this.delegate.viewWillCacheSnapshot();const{lastRenderedLocation:s}=this;await xs();const n=t.clone();return this.snapshotCache.put(s,n),n}}getCachedSnapshotForLocation(t){return this.snapshotCache.get(t)}isPageRefresh(t){return!t||this.lastRenderedLocation.href===t.location.href&&t.action==="replace"}get snapshot(){return I.fromElement(this.element)}}class wo{constructor(e){h(this,"selector","a[data-turbo-preload]");this.delegate=e}get snapshotCache(){return this.delegate.navigator.view.snapshotCache}start(){if(document.readyState==="loading")return document.addEventListener("DOMContentLoaded",()=>{this.preloadOnLoadLinksForView(document.body)});this.preloadOnLoadLinksForView(document.body)}preloadOnLoadLinksForView(e){for(const t of e.querySelectorAll(this.selector))this.preloadURL(t)}async preloadURL(e){const t=new URL(e.href);if(!this.snapshotCache.has(t))try{const n=await(await Jt(t.toString(),{headers:{"Sec-Purpose":"prefetch",Accept:"text/html"}})).text(),i=I.fromHTMLString(n);this.snapshotCache.put(t,i)}catch{}}}class So extends Set{constructor(e){super(),this.maxSize=e}add(e){if(this.size>=this.maxSize){const s=this.values().next().value;this.delete(s)}super.add(e)}}var ue,Ke;class _o{constructor(e){p(this,ue);this.session=e}clear(){this.session.clearCache()}resetCacheControl(){f(this,ue,Ke).call(this,"")}exemptPageFromCache(){f(this,ue,Ke).call(this,"no-cache")}exemptPageFromPreview(){f(this,ue,Ke).call(this,"no-preview")}}ue=new WeakSet,Ke=function(e){hi("turbo-cache-control",e)};class Eo{constructor(){h(this,"navigator",new Ui(this));h(this,"history",new ji(this));h(this,"preloader",new wo(this));h(this,"view",new yo(this,document.documentElement));h(this,"adapter",new qi(this));h(this,"pageObserver",new Ki(this));h(this,"cacheObserver",new Vi);h(this,"linkClickObserver",new Zs(this,window));h(this,"formSubmitObserver",new Qt(this,document));h(this,"scrollObserver",new zi(this));h(this,"streamObserver",new Zi(this));h(this,"formLinkClickObserver",new er(this,document.documentElement));h(this,"frameRedirector",new Wi(this,document.documentElement));h(this,"streamMessageRenderer",new Ji);h(this,"cache",new _o(this));h(this,"recentRequests",new So(20));h(this,"drive",!0);h(this,"enabled",!0);h(this,"progressBarDelay",500);h(this,"started",!1);h(this,"formMode","on")}start(){this.started||(this.pageObserver.start(),this.cacheObserver.start(),this.formLinkClickObserver.start(),this.linkClickObserver.start(),this.formSubmitObserver.start(),this.scrollObserver.start(),this.streamObserver.start(),this.frameRedirector.start(),this.history.start(),this.preloader.start(),this.started=!0,this.enabled=!0)}disable(){this.enabled=!1}stop(){this.started&&(this.pageObserver.stop(),this.cacheObserver.stop(),this.formLinkClickObserver.stop(),this.linkClickObserver.stop(),this.formSubmitObserver.stop(),this.scrollObserver.stop(),this.streamObserver.stop(),this.frameRedirector.stop(),this.history.stop(),this.started=!1)}registerAdapter(e){this.adapter=e}visit(e,t={}){const s=t.frame?document.getElementById(t.frame):null;s instanceof N?(s.src=e.toString(),s.loaded):this.navigator.proposeVisit(T(e),t)}refresh(e,t){t&&this.recentRequests.has(t)||(this.cache.exemptPageFromPreview(),this.visit(e,{action:"replace"}))}connectStreamSource(e){this.streamObserver.connectStreamSource(e)}disconnectStreamSource(e){this.streamObserver.disconnectStreamSource(e)}renderStreamMessage(e){this.streamMessageRenderer.render(te.wrap(e))}clearCache(){this.view.clearSnapshotCache()}setProgressBarDelay(e){this.progressBarDelay=e}setFormMode(e){this.formMode=e}get location(){return this.history.location}get restorationIdentifier(){return this.history.restorationIdentifier}historyPoppedToLocationWithRestorationIdentifier(e,t){this.enabled?this.navigator.startVisit(e,t,{action:"restore",historyChanged:!0}):this.adapter.pageInvalidated({reason:"turbo_disabled"})}scrollPositionChanged(e){this.history.updateRestorationData({scrollPosition:e})}willSubmitFormLinkToLocation(e,t){return this.elementIsNavigatable(e)&&ie(t,this.snapshot.rootLocation)}submittedFormLinkToLocation(){}willFollowLinkToLocation(e,t,s){return this.elementIsNavigatable(e)&&ie(t,this.snapshot.rootLocation)&&this.applicationAllowsFollowingLinkToLocation(e,t,s)}followedLinkToLocation(e,t){const s=this.getActionForLink(e),n=e.hasAttribute("data-turbo-stream");this.visit(t.href,{action:s,acceptsStreamResponse:n})}allowsVisitingLocationWithAction(e,t){return this.locationWithActionIsSamePage(e,t)||this.applicationAllowsVisitingLocation(e)}visitProposedToLocation(e,t){ws(e),this.adapter.visitProposedToLocation(e,t)}visitStarted(e){e.acceptsStreamResponse||Ft(document.documentElement),ws(e.location),e.silent||this.notifyApplicationAfterVisitingLocation(e.location,e.action)}visitCompleted(e){Dt(document.documentElement),this.notifyApplicationAfterPageLoad(e.getTimingMetrics())}locationWithActionIsSamePage(e,t){return this.navigator.locationWithActionIsSamePage(e,t)}visitScrolledToSamePageLocation(e,t){this.notifyApplicationAfterVisitingSamePageLocation(e,t)}willSubmitForm(e,t){const s=Ut(e,t);return this.submissionIsNavigatable(e,t)&&ie(T(s),this.snapshot.rootLocation)}formSubmitted(e,t){this.navigator.submitForm(e,t)}pageBecameInteractive(){this.view.lastRenderedLocation=this.location,this.notifyApplicationAfterPageLoad()}pageLoaded(){this.history.assumeControlOfScrollRestoration()}pageWillUnload(){this.history.relinquishControlOfScrollRestoration()}receivedMessageFromStream(e){this.renderStreamMessage(e)}viewWillCacheSnapshot(){var e;(e=this.navigator.currentVisit)!=null&&e.silent||this.notifyApplicationBeforeCachingSnapshot()}allowsImmediateRender({element:e},t,s){const n=this.notifyApplicationBeforeRender(e,t,s),{defaultPrevented:i,detail:{render:o}}=n;return this.view.renderer&&o&&(this.view.renderer.renderElement=o),!i}viewRenderedSnapshot(e,t,s){this.view.lastRenderedLocation=this.history.location,this.notifyApplicationAfterRender(t,s)}preloadOnLoadLinksForView(e){this.preloader.preloadOnLoadLinksForView(e)}viewInvalidated(e){this.adapter.pageInvalidated(e)}frameLoaded(e){this.notifyApplicationAfterFrameLoad(e)}frameRendered(e,t){this.notifyApplicationAfterFrameRender(e,t)}applicationAllowsFollowingLinkToLocation(e,t,s){return!this.notifyApplicationAfterClickingLinkToLocation(e,t,s).defaultPrevented}applicationAllowsVisitingLocation(e){return!this.notifyApplicationBeforeVisitingLocation(e).defaultPrevented}notifyApplicationAfterClickingLinkToLocation(e,t,s){return E("turbo:click",{target:e,detail:{url:t.href,originalEvent:s},cancelable:!0})}notifyApplicationBeforeVisitingLocation(e){return E("turbo:before-visit",{detail:{url:e.href},cancelable:!0})}notifyApplicationAfterVisitingLocation(e,t){return E("turbo:visit",{detail:{url:e.href,action:t}})}notifyApplicationBeforeCachingSnapshot(){return E("turbo:before-cache")}notifyApplicationBeforeRender(e,t,s){return E("turbo:before-render",{detail:{newBody:e,isPreview:t,...s},cancelable:!0})}notifyApplicationAfterRender(e,t){return E("turbo:render",{detail:{isPreview:e,renderMethod:t}})}notifyApplicationAfterPageLoad(e={}){return E("turbo:load",{detail:{url:this.location.href,timing:e}})}notifyApplicationAfterVisitingSamePageLocation(e,t){dispatchEvent(new HashChangeEvent("hashchange",{oldURL:e.toString(),newURL:t.toString()}))}notifyApplicationAfterFrameLoad(e){return E("turbo:frame-load",{target:e})}notifyApplicationAfterFrameRender(e,t){return E("turbo:frame-render",{detail:{fetchResponse:e},target:t,cancelable:!0})}submissionIsNavigatable(e,t){if(this.formMode=="off")return!1;{const s=t?this.elementIsNavigatable(t):!0;return this.formMode=="optin"?s&&e.closest('[data-turbo="true"]')!=null:s&&this.elementIsNavigatable(e)}}elementIsNavigatable(e){const t=Qe(e,"[data-turbo]"),s=Qe(e,"turbo-frame");return this.drive||s?t?t.getAttribute("data-turbo")!="false":!0:t?t.getAttribute("data-turbo")=="true":!1}getActionForLink(e){return Ct(e)||"advance"}get snapshot(){return this.view.snapshot}}function ws(r){Object.defineProperties(r,Co)}const Co={absoluteURL:{get(){return this.toString()}}},y=new Eo,{cache:To,navigator:Ao}=y;function mr(){y.start()}function ko(r){y.registerAdapter(r)}function Ro(r,e){y.visit(r,e)}function es(r){y.connectStreamSource(r)}function ts(r){y.disconnectStreamSource(r)}function Mo(r){y.renderStreamMessage(r)}function Io(){console.warn("Please replace `Turbo.clearCache()` with `Turbo.cache.clear()`. The top-level function is deprecated and will be removed in a future version of Turbo.`"),y.clearCache()}function Po(r){y.setProgressBarDelay(r)}function Lo(r){De.confirmMethod=r}function Oo(r){y.setFormMode(r)}var Fo=Object.freeze({__proto__:null,navigator:Ao,session:y,cache:To,PageRenderer:Ht,PageSnapshot:I,FrameRenderer:Bt,fetch:Jt,start:mr,registerAdapter:ko,visit:Ro,connectStreamSource:es,disconnectStreamSource:ts,renderStreamMessage:Mo,clearCache:Io,setProgressBarDelay:Po,setConfirmMethod:Lo,setFormMode:Oo});class Do extends Error{}var de,P,q,Ie,fe,B,K,mt,gr,gt,br,bt,vr,vt,yr,yt,wr,wt,Sr,St,_r,Pe,xt,V,re,_t,Er,pe,ze,Le,qt,me,Je,Et,Cr;class Bo{constructor(e){p(this,B);p(this,mt);p(this,gt);p(this,bt);p(this,vt);p(this,yt);p(this,wt);p(this,St);p(this,Pe);p(this,V);p(this,_t);p(this,pe);p(this,Le);p(this,me);p(this,Et);h(this,"fetchResponseLoaded",e=>Promise.resolve());p(this,de,null);p(this,P,()=>{});p(this,q,!1);p(this,Ie,!1);p(this,fe,new Set);h(this,"action",null);h(this,"visitCachedSnapshot",({element:e})=>{const t=e.querySelector("#"+this.element.id);t&&this.previousFrameElement&&t.replaceChildren(...this.previousFrameElement.children),delete this.previousFrameElement});this.element=e,this.view=new Ti(this,this.element),this.appearanceObserver=new pi(this,this.element),this.formLinkClickObserver=new er(this,this.element),this.linkInterceptor=new Qs(this,this.element),this.restorationIdentifier=W(),this.formSubmitObserver=new Qt(this,this.element)}connect(){g(this,q)||(C(this,q,!0),this.loadingStyle==ne.lazy?this.appearanceObserver.start():f(this,B,K).call(this),this.formLinkClickObserver.start(),this.linkInterceptor.start(),this.formSubmitObserver.start())}disconnect(){g(this,q)&&(C(this,q,!1),this.appearanceObserver.stop(),this.formLinkClickObserver.stop(),this.linkInterceptor.stop(),this.formSubmitObserver.stop())}disabledChanged(){this.loadingStyle==ne.eager&&f(this,B,K).call(this)}sourceURLChanged(){f(this,Le,qt).call(this,"src")||(this.element.isConnected&&(this.complete=!1),(this.loadingStyle==ne.eager||g(this,Ie))&&f(this,B,K).call(this))}sourceURLReloaded(){const{src:e}=this.element;return f(this,me,Je).call(this,"complete",()=>{this.element.removeAttribute("complete")}),this.element.src=null,this.element.src=e,this.element.loaded}completeChanged(){f(this,Le,qt).call(this,"complete")||f(this,B,K).call(this)}loadingStyleChanged(){this.loadingStyle==ne.lazy?this.appearanceObserver.start():(this.appearanceObserver.stop(),f(this,B,K).call(this))}async loadResponse(e){(e.redirected||e.succeeded&&e.isHTML)&&(this.sourceURL=e.response.url);try{const t=await e.responseHTML;if(t){const s=qs(t);I.fromDocument(s).isVisitable?await f(this,mt,gr).call(this,e,s):await f(this,vt,yr).call(this,e)}}finally{this.fetchResponseLoaded=()=>Promise.resolve()}}elementAppearedInViewport(e){this.proposeVisitIfNavigatedWithAction(e,e),f(this,B,K).call(this)}willSubmitFormLinkToLocation(e){return f(this,pe,ze).call(this,e)}submittedFormLinkToLocation(e,t,s){const n=f(this,V,re).call(this,e);n&&s.setAttribute("data-turbo-frame",n.id)}shouldInterceptLinkClick(e,t,s){return f(this,pe,ze).call(this,e)}linkClickIntercepted(e,t){f(this,bt,vr).call(this,e,t)}willSubmitForm(e,t){return e.closest("turbo-frame")==this.element&&f(this,pe,ze).call(this,e,t)}formSubmitted(e,t){this.formSubmission&&this.formSubmission.stop(),this.formSubmission=new De(this,e,t);const{fetchRequest:s}=this.formSubmission;this.prepareRequest(s),this.formSubmission.start()}prepareRequest(e){var t;e.headers["Turbo-Frame"]=this.id,(t=this.currentNavigationElement)!=null&&t.hasAttribute("data-turbo-stream")&&e.acceptResponseType(te.contentType)}requestStarted(e){Ft(this.element)}requestPreventedHandlingResponse(e,t){g(this,P).call(this)}async requestSucceededWithResponse(e,t){await this.loadResponse(t),g(this,P).call(this)}async requestFailedWithResponse(e,t){await this.loadResponse(t),g(this,P).call(this)}requestErrored(e,t){console.error(t),g(this,P).call(this)}requestFinished(e){Dt(this.element)}formSubmissionStarted({formElement:e}){Ft(e,f(this,V,re).call(this,e))}formSubmissionSucceededWithResponse(e,t){const s=f(this,V,re).call(this,e.formElement,e.submitter);s.delegate.proposeVisitIfNavigatedWithAction(s,e.formElement,e.submitter),s.delegate.loadResponse(t),e.isSafe||y.clearCache()}formSubmissionFailedWithResponse(e,t){this.element.delegate.loadResponse(t),y.clearCache()}formSubmissionErrored(e,t){console.error(t)}formSubmissionFinished({formElement:e}){Dt(e,f(this,V,re).call(this,e))}allowsImmediateRender({element:e},t,s){const n=E("turbo:before-frame-render",{target:this.element,detail:{newFrame:e,...s},cancelable:!0}),{defaultPrevented:i,detail:{render:o}}=n;return this.view.renderer&&o&&(this.view.renderer.renderElement=o),!i}viewRenderedSnapshot(e,t,s){}preloadOnLoadLinksForView(e){y.preloadOnLoadLinksForView(e)}viewInvalidated(){}willRenderFrame(e,t){this.previousFrameElement=e.cloneNode(!0)}proposeVisitIfNavigatedWithAction(e,t,s){if(this.action=Ct(s,t,e),this.action){const n=I.fromElement(e).clone(),{visitCachedSnapshot:i}=e.delegate;e.delegate.fetchResponseLoaded=async o=>{if(e.src){const{statusCode:a,redirected:l}=o,u=await o.responseHTML,b={response:{statusCode:a,redirected:l,responseHTML:u},visitCachedSnapshot:i,willRender:!1,updateHistory:!1,restorationIdentifier:this.restorationIdentifier,snapshot:n};this.action&&(b.action=this.action),y.visit(e.src,b)}}}}changeHistory(){if(this.action){const e=Ws(this.action);y.history.update(e,T(this.element.src||""),this.restorationIdentifier)}}async extractForeignFrameElement(e){let t;const s=CSS.escape(this.id);try{if(t=_s(e.querySelector(`turbo-frame#${s}`),this.sourceURL),t)return t;if(t=_s(e.querySelector(`turbo-frame[src][recurse~=${s}]`),this.sourceURL),t)return await t.loaded,await this.extractForeignFrameElement(t)}catch(n){return console.error(n),new N}return null}get id(){return this.element.id}get enabled(){return!this.element.disabled}get sourceURL(){if(this.element.src)return this.element.src}set sourceURL(e){f(this,me,Je).call(this,"src",()=>{this.element.src=e??null})}get loadingStyle(){return this.element.loading}get isLoading(){return this.formSubmission!==void 0||g(this,P).call(this)!==void 0}get complete(){return this.element.hasAttribute("complete")}set complete(e){f(this,me,Je).call(this,"complete",()=>{e?this.element.setAttribute("complete",""):this.element.removeAttribute("complete")})}get isActive(){return this.element.isActive&&g(this,q)}get rootLocation(){const e=this.element.ownerDocument.querySelector('meta[name="turbo-root"]'),t=(e==null?void 0:e.content)??"/";return T(t)}}de=new WeakMap,P=new WeakMap,q=new WeakMap,Ie=new WeakMap,fe=new WeakMap,B=new WeakSet,K=async function(){this.enabled&&this.isActive&&!this.complete&&this.sourceURL&&(this.element.loaded=f(this,gt,br).call(this,T(this.sourceURL)),this.appearanceObserver.stop(),await this.element.loaded,C(this,Ie,!0))},mt=new WeakSet,gr=async function(e,t){const s=await this.extractForeignFrameElement(t.body);if(s){const n=new Tt(s),i=new Bt(this,this.view.snapshot,n,Bt.renderElement,!1,!1);this.view.renderPromise&&await this.view.renderPromise,this.changeHistory(),await this.view.render(i),this.complete=!0,y.frameRendered(e,this.element),y.frameLoaded(this.element),await this.fetchResponseLoaded(e)}else f(this,yt,wr).call(this,e)&&f(this,wt,Sr).call(this,e)},gt=new WeakSet,br=async function(e){var s;const t=new Gt(this,L.get,e,new URLSearchParams,this.element);return(s=g(this,de))==null||s.cancel(),C(this,de,t),new Promise(n=>{C(this,P,()=>{C(this,P,()=>{}),C(this,de,null),n()}),t.perform()})},bt=new WeakSet,vr=function(e,t,s){const n=f(this,V,re).call(this,e,s);n.delegate.proposeVisitIfNavigatedWithAction(n,e,s),f(this,Et,Cr).call(this,e,()=>{n.src=t})},vt=new WeakSet,yr=async function(e){console.warn(`The response (${e.statusCode}) from <turbo-frame id="${this.element.id}"> is performing a full page visit due to turbo-visit-control.`),await f(this,Pe,xt).call(this,e.response)},yt=new WeakSet,wr=function(e){this.element.setAttribute("complete","");const t=e.response,s=async(i,o)=>{i instanceof Response?f(this,Pe,xt).call(this,i):y.visit(i,o)};return!E("turbo:frame-missing",{target:this.element,detail:{response:t,visit:s},cancelable:!0}).defaultPrevented},wt=new WeakSet,Sr=function(e){this.view.missing(),f(this,St,_r).call(this,e)},St=new WeakSet,_r=function(e){const t=`The response (${e.statusCode}) did not contain the expected <turbo-frame id="${this.element.id}"> and will be ignored. To perform a full page visit instead, set turbo-visit-control to reload.`;throw new Do(t)},Pe=new WeakSet,xt=async function(e){const t=new Kt(e),s=await t.responseHTML,{location:n,redirected:i,statusCode:o}=t;return y.visit(n,{response:{redirected:i,statusCode:o,responseHTML:s}})},V=new WeakSet,re=function(e,t){const s=Ge("data-turbo-frame",t,e)||this.element.getAttribute("target");return Ss(s)??this.element},_t=new WeakSet,Er=function(e,t){const s=Ut(e,t);return ie(T(s),this.rootLocation)},pe=new WeakSet,ze=function(e,t){const s=Ge("data-turbo-frame",t,e)||this.element.getAttribute("target");if(e instanceof HTMLFormElement&&!f(this,_t,Er).call(this,e,t)||!this.enabled||s=="_top")return!1;if(s){const n=Ss(s);if(n)return!n.disabled}return!(!y.elementIsNavigatable(e)||t&&!y.elementIsNavigatable(t))},Le=new WeakSet,qt=function(e){return g(this,fe).has(e)},me=new WeakSet,Je=function(e,t){g(this,fe).add(e),t(),g(this,fe).delete(e)},Et=new WeakSet,Cr=function(e,t){this.currentNavigationElement=e,t(),delete this.currentNavigationElement};function Ss(r){if(r!=null){const e=document.getElementById(r);if(e instanceof N)return e}}function _s(r,e){if(r){const t=r.getAttribute("src");if(t!=null&&e!=null&&Yn(t,e))throw new Error(`Matching <turbo-frame id="${r.id}"> element has a source URL which references itself`);if(r.ownerDocument!==document&&(r=document.importNode(r,!0)),r instanceof N)return r.connectedCallback(),r.disconnectedCallback(),r}}const No={after(){this.targetElements.forEach(r=>{var e;return(e=r.parentElement)==null?void 0:e.insertBefore(this.templateContent,r.nextSibling)})},append(){this.removeDuplicateTargetChildren(),this.targetElements.forEach(r=>r.append(this.templateContent))},before(){this.targetElements.forEach(r=>{var e;return(e=r.parentElement)==null?void 0:e.insertBefore(this.templateContent,r)})},prepend(){this.removeDuplicateTargetChildren(),this.targetElements.forEach(r=>r.prepend(this.templateContent))},remove(){this.targetElements.forEach(r=>r.remove())},replace(){this.targetElements.forEach(r=>r.replaceWith(this.templateContent))},update(){this.targetElements.forEach(r=>{r.innerHTML="",r.append(this.templateContent)})},refresh(){y.refresh(this.baseURI,this.requestId)}};var X,ve;const is=class is extends HTMLElement{constructor(){super(...arguments);p(this,X)}static async renderElement(t){await t.performAction()}async connectedCallback(){try{await this.render()}catch(t){console.error(t)}finally{this.disconnect()}}async render(){return this.renderPromise??(this.renderPromise=(async()=>{const t=this.beforeRenderEvent;this.dispatchEvent(t)&&(await ni(),await t.detail.render(this))})())}disconnect(){try{this.remove()}catch{}}removeDuplicateTargetChildren(){this.duplicateChildren.forEach(t=>t.remove())}get duplicateChildren(){var n;const t=this.targetElements.flatMap(i=>[...i.children]).filter(i=>!!i.id),s=[...((n=this.templateContent)==null?void 0:n.children)||[]].filter(i=>!!i.id).map(i=>i.id);return t.filter(i=>s.includes(i.id))}get performAction(){if(this.action){const t=No[this.action];if(t)return t;f(this,X,ve).call(this,"unknown action")}f(this,X,ve).call(this,"action attribute is missing")}get targetElements(){if(this.target)return this.targetElementsById;if(this.targets)return this.targetElementsByQuery;f(this,X,ve).call(this,"target or targets attribute is missing")}get templateContent(){return this.templateElement.content.cloneNode(!0)}get templateElement(){if(this.firstElementChild===null){const t=this.ownerDocument.createElement("template");return this.appendChild(t),t}else if(this.firstElementChild instanceof HTMLTemplateElement)return this.firstElementChild;f(this,X,ve).call(this,"first child element must be a <template> element")}get action(){return this.getAttribute("action")}get target(){return this.getAttribute("target")}get targets(){return this.getAttribute("targets")}get requestId(){return this.getAttribute("request-id")}get description(){return(this.outerHTML.match(/<[^>]+>/)??[])[0]??"<turbo-stream>"}get beforeRenderEvent(){return new CustomEvent("turbo:before-stream-render",{bubbles:!0,cancelable:!0,detail:{newStream:this,render:is.renderElement}})}get targetElementsById(){var s;const t=(s=this.ownerDocument)==null?void 0:s.getElementById(this.target);return t!==null?[t]:[]}get targetElementsByQuery(){var s;const t=(s=this.ownerDocument)==null?void 0:s.querySelectorAll(this.targets);return t.length!==0?Array.prototype.slice.call(t):[]}};X=new WeakSet,ve=function(t){throw new Error(`${this.description}: ${t}`)};let Vt=is;class $o extends HTMLElement{constructor(){super(...arguments);h(this,"streamSource",null)}connectedCallback(){this.streamSource=this.src.match(/^ws{1,2}:/)?new WebSocket(this.src):new EventSource(this.src),es(this.streamSource)}disconnectedCallback(){this.streamSource&&(this.streamSource.close(),ts(this.streamSource))}get src(){return this.getAttribute("src")||""}}N.delegateConstructor=Bo;customElements.get("turbo-frame")===void 0&&customElements.define("turbo-frame",N);customElements.get("turbo-stream")===void 0&&customElements.define("turbo-stream",Vt);customElements.get("turbo-stream-source")===void 0&&customElements.define("turbo-stream-source",$o);(()=>{let r=document.currentScript;if(r&&!r.hasAttribute("data-turbo-suppress-warning"))for(r=r.parentElement;r;){if(r==document.body)return console.warn(Vs`
        You are loading Turbo from a <script> element inside the <body> element. This is probably not what you meant to do!

        Load your applicationâs JavaScript bundle inside the <head> element instead. <script> elements in <body> are evaluated with each page change.

        For more information, see: https://turbo.hotwired.dev/handbook/building#working-with-script-elements

        ââ
        Suppress this warning by adding a "data-turbo-suppress-warning" attribute to: %s
      `,r.outerHTML);r=r.parentElement}})();window.Turbo=Fo;mr();var Ho=/^(?:.*?(?:controllers|components)\/|\.?\.\/)?(.+)(?:[/_-]controller\..+?)$/;function xo(r,e){r.load(qo(e))}function qo(r){return Object.entries(r).map(Vo).filter(e=>e)}function Vo([r,e]){const t=Wo(r),s=e.default;if(t&&typeof s=="function")return{identifier:t,controllerConstructor:s}}function Wo(r){const e=(r.match(Ho)||[])[1];if(e)return e.replace(/_/g,"-").replace(/\//g,"--")}class Q extends Error{constructor(e,t){const s=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=s}}class ss extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class M extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class jo extends Error{constructor(e,t){const s=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=s}}class Uo extends Error{constructor(e,t){const s=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=s}}class Ko extends Error{constructor(e,t){const s=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=s}}class Es extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class zo extends Error{constructor(e,t){const s=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=s}}class Tr{constructor(e,t,s){this.statusCode=e,this.statusText=t,this.content=s}}class kt{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var c;(function(r){r[r.Trace=0]="Trace",r[r.Debug=1]="Debug",r[r.Information=2]="Information",r[r.Warning=3]="Warning",r[r.Error=4]="Error",r[r.Critical=5]="Critical",r[r.None=6]="None"})(c||(c={}));class _e{constructor(){}log(e,t){}}_e.instance=new _e;const Jo="8.0.0";class S{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,s){if(!(e in t))throw new Error(`Unknown ${s} value: ${e}.`)}}class w{static get isBrowser(){return!w.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!w.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!w.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function Ee(r,e){let t="";return ee(r)?(t=`Binary data of length ${r.byteLength}`,e&&(t+=`. Content: '${Xo(r)}'`)):typeof r=="string"&&(t=`String data of length ${r.length}`,e&&(t+=`. Content: '${r}'`)),t}function Xo(r){const e=new Uint8Array(r);let t="";return e.forEach(s=>{const n=s<16?"0":"";t+=`0x${n}${s.toString(16)} `}),t.substr(0,t.length-1)}function ee(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}async function Ar(r,e,t,s,n,i){const o={},[a,l]=ge();o[a]=l,r.log(c.Trace,`(${e} transport) sending data. ${Ee(n,i.logMessageContent)}.`);const u=ee(n)?"arraybuffer":"text",d=await t.post(s,{content:n,headers:{...o,...i.headers},responseType:u,timeout:i.timeout,withCredentials:i.withCredentials});r.log(c.Trace,`(${e} transport) request complete. Response status: ${d.statusCode}.`)}function Go(r){return r===void 0?new et(c.Information):r===null?_e.instance:r.log!==void 0?r:new et(r)}class Yo{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class et{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const s=`[${new Date().toISOString()}] ${c[e]}: ${t}`;switch(e){case c.Critical:case c.Error:this.out.error(s);break;case c.Warning:this.out.warn(s);break;case c.Information:this.out.info(s);break;default:this.out.log(s);break}}}}function ge(){let r="X-SignalR-User-Agent";return w.isNode&&(r="User-Agent"),[r,Qo(Jo,Zo(),ta(),ea())]}function Qo(r,e,t,s){let n="Microsoft SignalR/";const i=r.split(".");return n+=`${i[0]}.${i[1]}`,n+=` (${r}; `,e&&e!==""?n+=`${e}; `:n+="Unknown OS; ",n+=`${t}`,s?n+=`; ${s}`:n+="; Unknown Runtime Version",n+=")",n}function Zo(){if(w.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function ea(){if(w.isNode)return process.versions.node}function ta(){return w.isNode?"NodeJS":"Browser"}function Cs(r){return r.stack?r.stack:r.message?r.message:`${r}`}function sa(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}function ra(r){return typeof fetch>"u"||w.isNode?(r._jar=new(require("tough-cookie")).CookieJar,typeof fetch>"u"?r._fetchType=require("node-fetch"):r._fetchType=fetch,r._fetchType=require("fetch-cookie")(r._fetchType,r._jar),!0):!1}function na(r){return typeof AbortController>"u"?(r._abortControllerType=require("abort-controller"),!0):!1}function ia(){return require("ws")}function oa(){return require("eventsource")}class aa extends kt{constructor(e){super(),this._logger=e;const t={_fetchType:void 0,_jar:void 0};ra(t)?(this._fetchType=t._fetchType,this._jar=t._jar):this._fetchType=fetch.bind(sa()),this._abortControllerType=AbortController;const s={_abortControllerType:this._abortControllerType};na(s)&&(this._abortControllerType=s._abortControllerType)}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new M;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let s;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),s=new M});let n=null;if(e.timeout){const l=e.timeout;n=setTimeout(()=>{t.abort(),this._logger.log(c.Warning,"Timeout from HTTP request."),s=new ss},l)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},ee(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");let i;try{i=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(l){throw s||(this._logger.log(c.Warning,`Error from HTTP request. ${l}.`),l)}finally{n&&clearTimeout(n),e.abortSignal&&(e.abortSignal.onabort=null)}if(!i.ok){const l=await Ts(i,"text");throw new Q(l||i.statusText,i.status)}const a=await Ts(i,e.responseType);return new Tr(i.status,i.statusText,a)}getCookieString(e){let t="";return w.isNode&&this._jar&&this._jar.getCookies(e,(s,n)=>t=n.join("; ")),t}}function Ts(r,e){let t;switch(e){case"arraybuffer":t=r.arrayBuffer();break;case"text":t=r.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:t=r.text();break}return t}class ca extends kt{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new M):e.method?e.url?new Promise((t,s)=>{const n=new XMLHttpRequest;n.open(e.method,e.url,!0),n.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,n.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(ee(e.content)?n.setRequestHeader("Content-Type","application/octet-stream"):n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const i=e.headers;i&&Object.keys(i).forEach(o=>{n.setRequestHeader(o,i[o])}),e.responseType&&(n.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{n.abort(),s(new M)}),e.timeout&&(n.timeout=e.timeout),n.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),n.status>=200&&n.status<300?t(new Tr(n.status,n.statusText,n.response||n.responseText)):s(new Q(n.response||n.responseText||n.statusText,n.status))},n.onerror=()=>{this._logger.log(c.Warning,`Error from HTTP request. ${n.status}: ${n.statusText}.`),s(new Q(n.statusText,n.status))},n.ontimeout=()=>{this._logger.log(c.Warning,"Timeout from HTTP request."),s(new ss)},n.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class la extends kt{constructor(e){if(super(),typeof fetch<"u"||w.isNode)this._httpClient=new aa(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new ca(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new M):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class R{static write(e){return`${e}${R.RecordSeparator}`}static parse(e){if(e[e.length-1]!==R.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(R.RecordSeparator);return t.pop(),t}}R.RecordSeparatorCode=30;R.RecordSeparator=String.fromCharCode(R.RecordSeparatorCode);class ha{writeHandshakeRequest(e){return R.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,s;if(ee(e)){const a=new Uint8Array(e),l=a.indexOf(R.RecordSeparatorCode);if(l===-1)throw new Error("Message is incomplete.");const u=l+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(a.slice(0,u))),s=a.byteLength>u?a.slice(u).buffer:null}else{const a=e,l=a.indexOf(R.RecordSeparator);if(l===-1)throw new Error("Message is incomplete.");const u=l+1;t=a.substring(0,u),s=a.length>u?a.substring(u):null}const n=R.parse(t),i=JSON.parse(n[0]);if(i.type)throw new Error("Expected a handshake response from the server.");return[s,i]}}var m;(function(r){r[r.Invocation=1]="Invocation",r[r.StreamItem=2]="StreamItem",r[r.Completion=3]="Completion",r[r.StreamInvocation=4]="StreamInvocation",r[r.CancelInvocation=5]="CancelInvocation",r[r.Ping=6]="Ping",r[r.Close=7]="Close",r[r.Ack=8]="Ack",r[r.Sequence=9]="Sequence"})(m||(m={}));class ua{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new Yo(this,e)}}class da{constructor(e,t,s){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=s}async _send(e){const t=this._protocol.writeMessage(e);let s=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let n=()=>{},i=()=>{};ee(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(s=new Promise((o,a)=>{n=o,i=a})),this._messages.push(new fa(t,this._totalMessageCount,n,i))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await s}_ack(e){let t=-1;for(let s=0;s<this._messages.length;s++){const n=this._messages[s];if(n._id<=e.sequenceId)t=s,ee(n._message)?this._bufferedByteCount-=n._message.byteLength:this._bufferedByteCount-=n._message.length,n._resolver();else if(this._bufferedByteCount<this._bufferSize)n._resolver();else break}t!==-1&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type!==m.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){if(e.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:m.Sequence,sequenceId:e}));const t=this._messages;for(const s of t)await this._connection.send(s._message);this._reconnectInProgress=!1}_dispose(e){e??(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case m.Invocation:case m.StreamItem:case m.Completion:case m.StreamInvocation:case m.CancelInvocation:return!0;case m.Close:case m.Sequence:case m.Ping:case m.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:m.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class fa{constructor(e,t,s,n){this._message=e,this._id=t,this._resolver=s,this._rejector=n}}const pa=30*1e3,ma=15*1e3,ga=1e5;var v;(function(r){r.Disconnected="Disconnected",r.Connecting="Connecting",r.Connected="Connected",r.Disconnecting="Disconnecting",r.Reconnecting="Reconnecting"})(v||(v={}));class rs{static create(e,t,s,n,i,o,a){return new rs(e,t,s,n,i,o,a)}constructor(e,t,s,n,i,o,a){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(c.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},S.isRequired(e,"connection"),S.isRequired(t,"logger"),S.isRequired(s,"protocol"),this.serverTimeoutInMilliseconds=i??pa,this.keepAliveIntervalInMilliseconds=o??ma,this._statefulReconnectBufferSize=a??ga,this._logger=t,this._protocol=s,this.connection=e,this._reconnectPolicy=n,this._handshakeProtocol=new ha,this.connection.onreceive=l=>this._processIncomingData(l),this.connection.onclose=l=>this._connectionClosed(l),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=v.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:m.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==v.Disconnected&&this._connectionState!==v.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==v.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=v.Connecting,this._logger.log(c.Debug,"Starting HubConnection.");try{await this._startInternal(),w.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=v.Connected,this._connectionStarted=!0,this._logger.log(c.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=v.Disconnected,this._logger.log(c.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,s)=>{this._handshakeResolver=t,this._handshakeRejecter=s});await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const s={protocol:this._protocol.name,version:t};if(this._logger.log(c.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(s)),this._logger.log(c.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new da(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(t){throw this._logger.log(c.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){if(this._connectionState===v.Disconnected)return this._logger.log(c.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===v.Disconnecting)return this._logger.log(c.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=v.Disconnecting,this._logger.log(c.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(c.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===v.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new M("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[s,n]=this._replaceStreamingParams(t),i=this._createStreamInvocation(e,t,n);let o;const a=new ua;return a.cancelCallback=()=>{const l=this._createCancelInvocation(i.invocationId);return delete this._callbacks[i.invocationId],o.then(()=>this._sendWithProtocol(l))},this._callbacks[i.invocationId]=(l,u)=>{if(u){a.error(u);return}else l&&(l.type===m.Completion?l.error?a.error(new Error(l.error)):a.complete():a.next(l.item))},o=this._sendWithProtocol(i).catch(l=>{a.error(l),delete this._callbacks[i.invocationId]}),this._launchStreams(s,o),a}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[s,n]=this._replaceStreamingParams(t),i=this._sendWithProtocol(this._createInvocation(e,t,!0,n));return this._launchStreams(s,i),i}invoke(e,...t){const[s,n]=this._replaceStreamingParams(t),i=this._createInvocation(e,t,!1,n);return new Promise((a,l)=>{this._callbacks[i.invocationId]=(d,b)=>{if(b){l(b);return}else d&&(d.type===m.Completion?d.error?l(new Error(d.error)):a(d.result):l(new Error(`Unexpected message type: ${d.type}`)))};const u=this._sendWithProtocol(i).catch(d=>{l(d),delete this._callbacks[i.invocationId]});this._launchStreams(s,u)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const s=this._methods[e];if(s)if(t){const n=s.indexOf(t);n!==-1&&(s.splice(n,1),s.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const s of t)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(s)))switch(s.type){case m.Invocation:this._invokeClientMethod(s);break;case m.StreamItem:case m.Completion:{const n=this._callbacks[s.invocationId];if(n){s.type===m.Completion&&delete this._callbacks[s.invocationId];try{n(s)}catch(i){this._logger.log(c.Error,`Stream callback threw error: ${Cs(i)}`)}}break}case m.Ping:break;case m.Close:{this._logger.log(c.Information,"Close message received from server.");const n=s.error?new Error("Server returned an error on close: "+s.error):void 0;s.allowReconnect===!0?this.connection.stop(n):this._stopPromise=this._stopInternal(n);break}case m.Ack:this._messageBuffer&&this._messageBuffer._ack(s);break;case m.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(s);break;default:this._logger.log(c.Warning,`Invalid message type: ${s.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,s;try{[s,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(n){const i="Error parsing handshake response: "+n;this._logger.log(c.Error,i);const o=new Error(i);throw this._handshakeRejecter(o),o}if(t.error){const n="Server returned handshake error: "+t.error;this._logger.log(c.Error,n);const i=new Error(n);throw this._handshakeRejecter(i),i}else this._logger.log(c.Debug,"Server handshake complete.");return this._handshakeResolver(),s}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===v.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),s=this._methods[t];if(!s){this._logger.log(c.Warning,`No client method with the name '${t}' found.`),e.invocationId&&(this._logger.log(c.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}const n=s.slice(),i=!!e.invocationId;let o,a,l;for(const u of n)try{const d=o;o=await u.apply(this,e.arguments),i&&o&&d&&(this._logger.log(c.Error,`Multiple results provided for '${t}'. Sending error to server.`),l=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),a=void 0}catch(d){a=d,this._logger.log(c.Error,`A callback for the method '${t}' threw error '${d}'.`)}l?await this._sendWithProtocol(l):i?(a?l=this._createCompletionMessage(e.invocationId,`${a}`,null):o!==void 0?l=this._createCompletionMessage(e.invocationId,null,o):(this._logger.log(c.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),l=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(l)):o&&this._logger.log(c.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(c.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new M("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===v.Disconnecting?this._completeClose(e):this._connectionState===v.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===v.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=v.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e??new Error("Connection closed.")),this._messageBuffer=void 0),w.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(c.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let s=0,n=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),i=this._getNextRetryDelay(s++,0,n);if(i===null){this._logger.log(c.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=v.Reconnecting,e?this._logger.log(c.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(c.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(o=>o.apply(this,[e]))}catch(o){this._logger.log(c.Error,`An onreconnecting callback called with error '${e}' threw error '${o}'.`)}if(this._connectionState!==v.Reconnecting){this._logger.log(c.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;i!==null;){if(this._logger.log(c.Information,`Reconnect attempt number ${s} will start in ${i} ms.`),await new Promise(o=>{this._reconnectDelayHandle=setTimeout(o,i)}),this._reconnectDelayHandle=void 0,this._connectionState!==v.Reconnecting){this._logger.log(c.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=v.Connected,this._logger.log(c.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(o=>o.apply(this,[this.connection.connectionId]))}catch(o){this._logger.log(c.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${o}'.`)}return}catch(o){if(this._logger.log(c.Information,`Reconnect attempt failed because of error '${o}'.`),this._connectionState!==v.Reconnecting){this._logger.log(c.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===v.Disconnecting&&this._completeClose();return}n=o instanceof Error?o:new Error(o.toString()),i=this._getNextRetryDelay(s++,Date.now()-t,n)}}this._logger.log(c.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${s} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,s){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:s})}catch(n){return this._logger.log(c.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${n}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(s=>{const n=t[s];try{n(null,e)}catch(i){this._logger.log(c.Error,`Stream 'error' callback called with '${e}' threw error: ${Cs(i)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,s,n){if(s)return n.length!==0?{arguments:t,streamIds:n,target:e,type:m.Invocation}:{arguments:t,target:e,type:m.Invocation};{const i=this._invocationId;return this._invocationId++,n.length!==0?{arguments:t,invocationId:i.toString(),streamIds:n,target:e,type:m.Invocation}:{arguments:t,invocationId:i.toString(),target:e,type:m.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const s in e)e[s].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(s)))},error:n=>{let i;n instanceof Error?i=n.message:n&&n.toString?i=n.toString():i="Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(s,i)))},next:n=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(s,n)))}})}}_replaceStreamingParams(e){const t=[],s=[];for(let n=0;n<e.length;n++){const i=e[n];if(this._isObservable(i)){const o=this._invocationId;this._invocationId++,t[o]=i,s.push(o.toString()),e.splice(n,1)}}return[t,s]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,s){const n=this._invocationId;return this._invocationId++,s.length!==0?{arguments:t,invocationId:n.toString(),streamIds:s,target:e,type:m.StreamInvocation}:{arguments:t,invocationId:n.toString(),target:e,type:m.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:m.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:m.StreamItem}}_createCompletionMessage(e,t,s){return t?{error:t,invocationId:e,type:m.Completion}:{invocationId:e,result:s,type:m.Completion}}_createCloseMessage(){return{type:m.Close}}}const ba=[0,2e3,1e4,3e4,null];class As{constructor(e){this._retryDelays=e!==void 0?[...e,null]:ba}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class Z{}Z.Authorization="Authorization";Z.Cookie="Cookie";class va extends kt{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const s=await this._innerClient.send(e);return t&&s.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):s}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[Z.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[Z.Authorization]&&delete e.headers[Z.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var _;(function(r){r[r.None=0]="None",r[r.WebSockets=1]="WebSockets",r[r.ServerSentEvents=2]="ServerSentEvents",r[r.LongPolling=4]="LongPolling"})(_||(_={}));var A;(function(r){r[r.Text=1]="Text",r[r.Binary=2]="Binary"})(A||(A={}));let ya=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};class ks{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,s){this._httpClient=e,this._logger=t,this._pollAbort=new ya,this._options=s,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(S.isRequired(e,"url"),S.isRequired(t,"transferFormat"),S.isIn(t,A,"transferFormat"),this._url=e,this._logger.log(c.Trace,"(LongPolling transport) Connecting."),t===A.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[s,n]=ge(),i={[s]:n,...this._options.headers},o={abortSignal:this._pollAbort.signal,headers:i,timeout:1e5,withCredentials:this._options.withCredentials};t===A.Binary&&(o.responseType="arraybuffer");const a=`${e}&_=${Date.now()}`;this._logger.log(c.Trace,`(LongPolling transport) polling: ${a}.`);const l=await this._httpClient.get(a,o);l.statusCode!==200?(this._logger.log(c.Error,`(LongPolling transport) Unexpected response code: ${l.statusCode}.`),this._closeError=new Q(l.statusText||"",l.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,o)}async _poll(e,t){try{for(;this._running;)try{const s=`${e}&_=${Date.now()}`;this._logger.log(c.Trace,`(LongPolling transport) polling: ${s}.`);const n=await this._httpClient.get(s,t);n.statusCode===204?(this._logger.log(c.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):n.statusCode!==200?(this._logger.log(c.Error,`(LongPolling transport) Unexpected response code: ${n.statusCode}.`),this._closeError=new Q(n.statusText||"",n.statusCode),this._running=!1):n.content?(this._logger.log(c.Trace,`(LongPolling transport) data received. ${Ee(n.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(n.content)):this._logger.log(c.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(s){this._running?s instanceof ss?this._logger.log(c.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=s,this._running=!1):this._logger.log(c.Trace,`(LongPolling transport) Poll errored after shutdown: ${s.message}`)}}finally{this._logger.log(c.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?Ar(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(c.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(c.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,s]=ge();e[t]=s;const n={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let i;try{await this._httpClient.delete(this._url,n)}catch(o){i=o}i?i instanceof Q&&(i.statusCode===404?this._logger.log(c.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(c.Trace,`(LongPolling transport) Error sending a DELETE request: ${i}`)):this._logger.log(c.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(c.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(c.Trace,e),this.onclose(this._closeError)}}}class wa{constructor(e,t,s,n){this._httpClient=e,this._accessToken=t,this._logger=s,this._options=n,this.onreceive=null,this.onclose=null}async connect(e,t){return S.isRequired(e,"url"),S.isRequired(t,"transferFormat"),S.isIn(t,A,"transferFormat"),this._logger.log(c.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((s,n)=>{let i=!1;if(t!==A.Text){n(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let o;if(w.isBrowser||w.isWebWorker)o=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const a=this._httpClient.getCookieString(e),l={};l.Cookie=a;const[u,d]=ge();l[u]=d,o=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...l,...this._options.headers}})}try{o.onmessage=a=>{if(this.onreceive)try{this._logger.log(c.Trace,`(SSE transport) data received. ${Ee(a.data,this._options.logMessageContent)}.`),this.onreceive(a.data)}catch(l){this._close(l);return}},o.onerror=a=>{i?this._close():n(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},o.onopen=()=>{this._logger.log(c.Information,`SSE connected to ${this._url}`),this._eventSource=o,i=!0,s()}}catch(a){n(a);return}})}async send(e){return this._eventSource?Ar(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class Sa{constructor(e,t,s,n,i,o){this._logger=s,this._accessTokenFactory=t,this._logMessageContent=n,this._webSocketConstructor=i,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=o}async connect(e,t){S.isRequired(e,"url"),S.isRequired(t,"transferFormat"),S.isIn(t,A,"transferFormat"),this._logger.log(c.Trace,"(WebSockets transport) Connecting.");let s;return this._accessTokenFactory&&(s=await this._accessTokenFactory()),new Promise((n,i)=>{e=e.replace(/^http/,"ws");let o;const a=this._httpClient.getCookieString(e);let l=!1;if(w.isNode||w.isReactNative){const u={},[d,b]=ge();u[d]=b,s&&(u[Z.Authorization]=`Bearer ${s}`),a&&(u[Z.Cookie]=a),o=new this._webSocketConstructor(e,void 0,{headers:{...u,...this._headers}})}else s&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(s)}`);o||(o=new this._webSocketConstructor(e)),t===A.Binary&&(o.binaryType="arraybuffer"),o.onopen=u=>{this._logger.log(c.Information,`WebSocket connected to ${e}.`),this._webSocket=o,l=!0,n()},o.onerror=u=>{let d=null;typeof ErrorEvent<"u"&&u instanceof ErrorEvent?d=u.error:d="There was an error with the transport",this._logger.log(c.Information,`(WebSockets transport) ${d}.`)},o.onmessage=u=>{if(this._logger.log(c.Trace,`(WebSockets transport) data received. ${Ee(u.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(u.data)}catch(d){this._close(d);return}},o.onclose=u=>{if(l)this._close(u);else{let d=null;typeof ErrorEvent<"u"&&u instanceof ErrorEvent?d=u.error:d="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",i(new Error(d))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(c.Trace,`(WebSockets transport) sending data. ${Ee(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(c.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}const Rs=100;class _a{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,S.isRequired(e,"url"),this._logger=Go(t.logger),this.baseUrl=this._resolveUrl(e),t=t||{},t.logMessageContent=t.logMessageContent===void 0?!1:t.logMessageContent,typeof t.withCredentials=="boolean"||t.withCredentials===void 0)t.withCredentials=t.withCredentials===void 0?!0:t.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.timeout=t.timeout===void 0?100*1e3:t.timeout;let s=null,n=null;w.isNode&&typeof require<"u"&&(s=ia(),n=oa()),!w.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:w.isNode&&!t.WebSocket&&s&&(t.WebSocket=s),!w.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:w.isNode&&!t.EventSource&&typeof n<"u"&&(t.EventSource=n),this._httpClient=new va(t.httpClient||new la(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||A.Binary,S.isIn(e,A,"transferFormat"),this._logger.log(c.Debug,`Starting connection with transfer format '${A[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(c.Error,t),await this._stopPromise,Promise.reject(new M(t))}else if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(c.Error,t),Promise.reject(new M(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new ns(this.transport)),this._sendQueue.send(e))}async stop(e){if(this._connectionState==="Disconnected")return this._logger.log(c.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(c.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),await this._stopPromise}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(c.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(c.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===_.WebSockets)this.transport=this._constructTransport(_.WebSockets),await this._startTransport(t,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let s=null,n=0;do{if(s=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new M("The connection was stopped during negotiation.");if(s.error)throw new Error(s.error);if(s.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(s.url&&(t=s.url),s.accessToken){const i=s.accessToken;this._accessTokenFactory=()=>i,this._httpClient._accessToken=i,this._httpClient._accessTokenFactory=void 0}n++}while(s.url&&n<Rs);if(n===Rs&&s.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,s,e)}this.transport instanceof ks&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(c.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(s){return this._logger.log(c.Error,"Failed to start the connection: "+s),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(s)}}async _getNegotiationResponse(e){const t={},[s,n]=ge();t[s]=n;const i=this._resolveNegotiateUrl(e);this._logger.log(c.Debug,`Sending negotiation request: ${i}.`);try{const o=await this._httpClient.post(i,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(o.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${o.statusCode}'`));const a=JSON.parse(o.content);return(!a.negotiateVersion||a.negotiateVersion<1)&&(a.connectionToken=a.connectionId),a.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new Es("Client didn't negotiate Stateful Reconnect but the server did.")):a}catch(o){let a="Failed to complete negotiation with the server: "+o;return o instanceof Q&&o.statusCode===404&&(a=a+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(c.Error,a),Promise.reject(new Es(a))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,s,n){let i=this._createConnectUrl(e,s.connectionToken);if(this._isITransport(t)){this._logger.log(c.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(i,n),this.connectionId=s.connectionId;return}const o=[],a=s.availableTransports||[];let l=s;for(const u of a){const d=this._resolveTransportOrError(u,t,n,(l==null?void 0:l.useStatefulReconnect)===!0);if(d instanceof Error)o.push(`${u.transport} failed:`),o.push(d);else if(this._isITransport(d)){if(this.transport=d,!l){try{l=await this._getNegotiationResponse(e)}catch(b){return Promise.reject(b)}i=this._createConnectUrl(e,l.connectionToken)}try{await this._startTransport(i,n),this.connectionId=l.connectionId;return}catch(b){if(this._logger.log(c.Error,`Failed to start the transport '${u.transport}': ${b}`),l=void 0,o.push(new Ko(`${u.transport} failed: ${b}`,_[u.transport])),this._connectionState!=="Connecting"){const k="Failed to select transport before stop() was called.";return this._logger.log(c.Debug,k),Promise.reject(new M(k))}}}}return o.length>0?Promise.reject(new zo(`Unable to connect to the server with any of the available transports. ${o.join(" ")}`,o)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case _.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Sa(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case _.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new wa(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case _.LongPolling:return new ks(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async s=>{let n=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{n=!0}else{this._stopConnection(s);return}n&&this._stopConnection(s)}:this.transport.onclose=s=>this._stopConnection(s),this.transport.connect(e,t)}_resolveTransportOrError(e,t,s,n){const i=_[e.transport];if(i==null)return this._logger.log(c.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(Ea(t,i))if(e.transferFormats.map(a=>A[a]).indexOf(s)>=0){if(i===_.WebSockets&&!this._options.WebSocket||i===_.ServerSentEvents&&!this._options.EventSource)return this._logger.log(c.Debug,`Skipping transport '${_[i]}' because it is not supported in your environment.'`),new jo(`'${_[i]}' is not supported in your environment.`,i);this._logger.log(c.Debug,`Selecting transport '${_[i]}'.`);try{return this.features.reconnect=i===_.WebSockets?n:void 0,this._constructTransport(i)}catch(a){return a}}else return this._logger.log(c.Debug,`Skipping transport '${_[i]}' because it does not support the requested transfer format '${A[s]}'.`),new Error(`'${_[i]}' does not support ${A[s]}.`);else return this._logger.log(c.Debug,`Skipping transport '${_[i]}' because it was disabled by the client.`),new Uo(`'${_[i]}' is disabled by the client.`,i)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(c.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(c.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(c.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(c.Error,`Connection disconnected with error '${e}'.`):this._logger.log(c.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(c.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(c.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!w.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(c.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const s=new URLSearchParams(t.searchParams);return s.has("negotiateVersion")||s.append("negotiateVersion",this._negotiateVersion.toString()),s.has("useStatefulReconnect")?s.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&s.append("useStatefulReconnect","true"),t.search=s.toString(),t.toString()}}function Ea(r,e){return!r||(e&r)!==0}class ns{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new xe,this._transportResult=new xe,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new xe),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new xe;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):ns._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(s){e.reject(s)}}}static _concatBuffers(e){const t=e.map(i=>i.byteLength).reduce((i,o)=>i+o),s=new Uint8Array(t);let n=0;for(const i of e)s.set(new Uint8Array(i),n),n+=i.byteLength;return s.buffer}}class xe{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}const Ca="json";class Ta{constructor(){this.name=Ca,this.version=2,this.transferFormat=A.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=_e.instance);const s=R.parse(e),n=[];for(const i of s){const o=JSON.parse(i);if(typeof o.type!="number")throw new Error("Invalid payload.");switch(o.type){case m.Invocation:this._isInvocationMessage(o);break;case m.StreamItem:this._isStreamItemMessage(o);break;case m.Completion:this._isCompletionMessage(o);break;case m.Ping:break;case m.Close:break;case m.Ack:this._isAckMessage(o);break;case m.Sequence:this._isSequenceMessage(o);break;default:t.log(c.Information,"Unknown message type '"+o.type+"' ignored.");continue}n.push(o)}return n}writeMessage(e){return R.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const Aa={trace:c.Trace,debug:c.Debug,info:c.Information,information:c.Information,warn:c.Warning,warning:c.Warning,error:c.Error,critical:c.Critical,none:c.None};function ka(r){const e=Aa[r.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${r}`)}class Ra{configureLogging(e){if(S.isRequired(e,"logging"),Ma(e))this.logger=e;else if(typeof e=="string"){const t=ka(e);this.logger=new et(t)}else this.logger=new et(e);return this}withUrl(e,t){return S.isRequired(e,"url"),S.isNotEmpty(e,"url"),this.url=e,typeof t=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...t}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return S.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new As(e):this.reconnectPolicy=e:this.reconnectPolicy=new As,this}withServerTimeout(e){return S.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return S.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e==null?void 0:e.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new _a(this.url,e);return rs.create(t,this.logger||_e.instance,this.protocol||new Ta,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function Ma(r){return r.log!==void 0}class Ia extends HTMLElement{async connectedCallback(){es(this),this.connection=new Ra().withUrl(this.getAttribute("hub")).build(),this.connection.on(this.getAttribute("method"),e=>{this.dispatchMessageEvent(e)}),this.connection.start()}dispatchMessageEvent(e){const t=new MessageEvent("message",{data:e});return this.dispatchEvent(t)}disconnectedCallback(){ts(this),this.connection&&this.connection.stop()}}customElements.define("signalr-turbo-stream",Ia);y.drive=!0;const Pa=Cn.start(),La=Object.assign({"../controllers/foo_controller.js":qn,"../controllers/hello_controller.js":Vn,"../controllers/results_controller.js":Wn,"../controllers/search_controller.js":jn});xo(Pa,La);
